<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DriveSphere - Social GPS Tracking & Route Sharing</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #00ffff;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .navbar {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(255, 0, 255, 0.1) 100%);
            padding: 1rem 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 255, 255, 0.3);
            box-shadow: 
                0 8px 32px rgba(0, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .navbar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            cursor: pointer;
            background: linear-gradient(45deg, #00ffff, #ff00ff, #00ffff);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            position: relative;
            z-index: 1;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            list-style: none;
            position: relative;
            z-index: 1;
        }

        .nav-links li {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .nav-links li:hover {
            background: rgba(0, 255, 255, 0.15);
            border-color: rgba(0, 255, 255, 0.5);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .nav-links li.active {
            background: linear-gradient(45deg, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.2));
            border-color: rgba(0, 255, 255, 0.6);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .page {
            display: none;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.05) 0%, rgba(255, 0, 255, 0.05) 100%);
            padding: 2rem;
            border-radius: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 255, 255, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.5), transparent);
        }

        .page.active {
            display: block;
            animation: pageSlideIn 0.5s ease-out;
        }

        @keyframes pageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-container {
            max-width: 400px;
            margin: 2rem auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 1rem;
        }

        .btn {
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            color: white;
            border: 1px solid rgba(0, 255, 255, 0.5);
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            width: 100%;
            margin: 0.5rem 0;
            position: relative;
            overflow: hidden;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.5);
            border-color: rgba(0, 255, 255, 0.8);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn.secondary {
            background: linear-gradient(45deg, #00ff88, #00ffff);
            border-color: rgba(0, 255, 136, 0.5);
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
        }

        .btn.secondary:hover {
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.5);
            border-color: rgba(0, 255, 136, 0.8);
        }

        .btn.admin {
            background: linear-gradient(45deg, #ff0080, #ff00ff);
            border-color: rgba(255, 0, 128, 0.5);
            box-shadow: 0 4px 15px rgba(255, 0, 128, 0.3);
        }

        .btn.admin:hover {
            box-shadow: 0 8px 25px rgba(255, 0, 128, 0.5);
            border-color: rgba(255, 0, 128, 0.8);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .card {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.08) 0%, rgba(255, 0, 255, 0.08) 100%);
            padding: 1.5rem;
            border-radius: 15px;
            margin: 1rem 0;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 255, 255, 0.2);
            box-shadow: 
                0 4px 20px rgba(0, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 8px 30px rgba(0, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.4);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.5), transparent);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(255, 0, 255, 0.1) 100%);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 255, 255, 0.3);
            box-shadow: 
                0 4px 20px rgba(0, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 30px rgba(0, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.5);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.5), transparent);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.5rem;
            color: #00ffff;
        }

        #map {
            height: 400px;
            border-radius: 10px;
            margin: 1rem 0;
        }

        .hidden {
            display: none !important;
        }

        .remember-me {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .remember-me input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
        }

        .admin-panel {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff6b6b;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .admin-stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .admin-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 1rem 0;
        }

        .admin-actions .btn {
            flex: 1;
            min-width: 150px;
        }

        .route-tab {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 255, 0.1));
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            padding: 0.75rem 1.5rem;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .route-tab:hover {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.2));
            border-color: rgba(0, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .route-tab.active {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(255, 0, 255, 0.3));
            border-color: rgba(0, 255, 255, 0.6);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);
        }

        .route-content {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .route-item {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.08), rgba(255, 0, 255, 0.08));
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 10px;
            padding: 1rem;
            margin: 0.5rem 0;
            transition: all 0.3s ease;
        }

        .route-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.4);
        }

        .route-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin: 0.5rem 0;
        }

        .route-stat {
            background: rgba(0, 255, 255, 0.1);
            padding: 0.5rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .route-stat-value {
            font-weight: bold;
            color: #00ffff;
            font-size: 1.1rem;
        }

        .route-stat-label {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 0.25rem;
        }

        .admin-tab {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 255, 0.1));
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            padding: 0.75rem 1.5rem;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .admin-tab:hover {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.2));
            border-color: rgba(0, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .admin-tab.active {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(255, 0, 255, 0.3));
            border-color: rgba(0, 255, 255, 0.6);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);
        }

        .admin-content {
            animation: fadeIn 0.5s ease-in-out;
        }

        .admin-item {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.08), rgba(255, 0, 255, 0.08));
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 10px;
            padding: 1rem;
            margin: 0.5rem 0;
            transition: all 0.3s ease;
        }

        .admin-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.4);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(255, 0, 255, 0.1) 100%);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px;
            padding: 0;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 255, 255, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.9) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
        }

        .modal-header h3 {
            margin: 0;
            color: #00ffff;
            font-size: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: #00ffff;
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 0, 0, 0.2);
            color: #ff6b6b;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding: 1.5rem;
            border-top: 1px solid rgba(0, 255, 255, 0.3);
        }

        .route-stats-preview {
            margin-bottom: 1.5rem;
        }

        .route-stats-preview h4 {
            margin: 0 0 1rem 0;
            color: #00ffff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: rgba(0, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .stat-label {
            color: #00ffff;
            font-weight: 500;
        }

        .stat-value {
            color: #ff00ff;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #00ffff;
            font-weight: 500;
        }

        .form-group input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #00ffff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input[type="text"]:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .privacy-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .privacy-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .privacy-option:hover {
            background: rgba(0, 255, 255, 0.1);
            border-color: rgba(0, 255, 255, 0.4);
        }

        .privacy-option input[type="radio"] {
            margin: 0;
        }

        .privacy-icon {
            font-size: 1.2rem;
        }

        .privacy-option span:last-child {
            color: #00ffff;
            font-weight: 500;
        }

        .post-card {
            margin-bottom: 2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .post-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.5), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .post-card:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 12px 40px rgba(0, 255, 255, 0.1),
                0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .post-card:hover::before {
            opacity: 1;
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .post-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.2rem;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .user-avatar::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s ease;
            opacity: 0;
        }

        .user-avatar:hover::before {
            animation: shimmer 0.6s ease-in-out;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
        }

        .user-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .username {
            margin: 0;
            color: #e2e8f0;
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: -0.025em;
        }

        .post-time {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.875rem;
            font-weight: 400;
        }

        .delete-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .delete-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
            transform: scale(1.05);
        }

        .post-content {
            margin-bottom: 1.5rem;
        }

        .post-text {
            margin: 0;
            line-height: 1.7;
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            font-weight: 400;
            letter-spacing: -0.01em;
        }

        .post-image {
            width: 100%;
            max-width: 600px;
            border-radius: 16px;
            margin-top: 1.25rem;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.2),
                0 4px 16px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            loading: lazy;
        }

        .post-image:hover {
            transform: scale(1.02);
            box-shadow: 
                0 12px 40px rgba(0, 0, 0, 0.3),
                0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .post-actions {
            display: flex;
            gap: 0.5rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            padding: 0.625rem 1rem;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            color: #ffffff;
            transform: translateY(-1px);
        }

        .like-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .comment-btn:hover {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
            color: #22c55e;
        }

        .share-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            color: #3b82f6;
        }

        .action-btn svg {
            transition: transform 0.2s ease;
        }

        .action-btn:hover svg {
            transform: scale(1.1);
        }

        .page-header {
            margin-bottom: 2rem;
            text-align: center;
        }

        .page-header h2 {
            margin: 0 0 0.5rem 0;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
            font-weight: 400;
            margin: 0;
        }

        .post-composer {
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
        }

        .composer-header {
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 1rem;
        }

        .composer-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .composer-info h3 {
            margin: 0 0 0.25rem 0;
            color: #e2e8f0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .composer-hint {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.875rem;
        }

        .composer-content textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            resize: vertical;
            font-size: 1rem;
            line-height: 1.6;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .composer-content textarea:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .composer-content textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .composer-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .composer-tools {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .composer-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .composer-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .photo-preview {
            color: #22c55e;
            font-size: 0.875rem;
            font-weight: 500;
            display: none;
        }

        .btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .welcome-card {
            text-align: center;
            padding: 3rem 2rem;
        }

        .welcome-content {
            max-width: 400px;
            margin: 0 auto;
        }

        .welcome-icon {
            color: rgba(102, 126, 234, 0.6);
            margin-bottom: 1.5rem;
        }

        .welcome-content h4 {
            margin: 0 0 1rem 0;
            color: #e2e8f0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .welcome-content p {
            margin: 0;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <!-- Auth Container -->
    <div id="authContainer" class="auth-container">
        <div style="text-align: center; margin-bottom: 2rem;">
            <h1>üöó DriveSphere</h1>
            <p>Welcome back! Sign in to continue your driving journey.</p>
        </div>

        <!-- Login Form -->
        <form id="loginForm">
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" required placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" required placeholder="Enter your password">
            </div>
            <div class="remember-me">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe">Remember me</label>
            </div>
            <button type="submit" class="btn">Sign In</button>
        </form>

        <div style="text-align: center; margin: 1rem 0;">
            <button class="btn secondary" onclick="switchToRegister()">Create New Account</button>
        </div>

        <div style="text-align: center;">
            <button class="btn admin" onclick="showAdminLogin()">Admin Login</button>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="auth-container hidden">
        <div style="text-align: center; margin-bottom: 2rem;">
            <h2>üîê Admin Login</h2>
        </div>
        <form id="adminLoginForm">
            <div class="form-group">
                <label for="adminKey">Admin Key</label>
                <input type="password" id="adminKey" required placeholder="Enter admin key">
            </div>
            <button type="submit" class="btn admin">Admin Login</button>
            <button type="button" class="btn secondary" onclick="hideAdminLogin()">Back to Login</button>
        </form>
    </div>

    <!-- Register Form -->
    <div id="registerContainer" class="auth-container hidden">
        <div style="text-align: center; margin-bottom: 2rem;">
            <h2>Create Account</h2>
        </div>
        <form id="registerForm">
            <div class="form-group">
                <label for="registerName">Full Name</label>
                <input type="text" id="registerName" required placeholder="Enter your full name">
            </div>
            <div class="form-group">
                <label for="registerUsername">Username</label>
                <input type="text" id="registerUsername" required placeholder="Choose a username">
                <div id="usernameStatus" style="font-size: 0.8rem; margin-top: 0.25rem;"></div>
            </div>
            <div class="form-group">
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" required placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label for="registerPassword">Password</label>
                <input type="password" id="registerPassword" required placeholder="Create a password">
            </div>
            <button type="submit" class="btn">Create Account</button>
            <button type="button" class="btn secondary" onclick="switchToLogin()">Back to Login</button>
        </form>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <div class="container">
            <nav class="navbar">
                <div class="logo" onclick="showPage('dashboard')">üöó DriveSphere</div>
                <ul class="nav-links">
                    <li onclick="showPage('dashboard')" class="active">Dashboard</li>
                    <li onclick="showPage('feed')">Feed</li>
                    <li onclick="showPage('routes')">Routes</li>
                    <li onclick="showPage('analytics')">Analytics</li>
                    <li onclick="showPage('profile')">Profile</li>
                </ul>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <span id="userDisplayName">User</span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </nav>

            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <h2>Dashboard</h2>
                
                <!-- XP Display -->
                <div id="xpDisplay" class="card">
                    <!-- XP content will be populated by JavaScript -->
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalDistance">0</div>
                        <div class="stat-label">Miles Driven</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalTime">0</div>
                        <div class="stat-label">Hours Driven</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgSpeed">0</div>
                        <div class="stat-label">Avg Speed (mph)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="maxSpeed">0</div>
                        <div class="stat-label">Max Speed (mph)</div>
                    </div>
                </div>
                
                <!-- G-Force Monitor (Mobile) -->
                <div id="gForceMonitor" class="card" style="display: none;">
                    <h3>G-Force Monitor</h3>
                    <div style="text-align: center; font-size: 2rem; margin: 1rem 0;">
                        <div id="gForceValue">0.0 G</div>
                        <div style="font-size: 1rem; opacity: 0.7;">Current G-Force</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Recent Activity</h3>
                    <p>No recent activity to display.</p>
                </div>
            </div>

            <!-- Feed Page -->
            <div id="feed" class="page">
                <div class="page-header">
                    <h2>Community Feed</h2>
                    <p class="page-subtitle">Share your driving experiences and connect with fellow drivers</p>
                </div>
                
                <div class="card post-composer">
                    <div class="composer-header">
                        <div class="composer-user">
                            <div class="user-avatar" id="composerAvatar">U</div>
                            <div class="composer-info">
                                <h3>Share Your Experience</h3>
                                <span class="composer-hint">What's on your mind?</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="composer-content">
                        <textarea id="postContent" placeholder="Share your driving experience, route insights, or tips with the community..." rows="4"></textarea>
                        
                        <div class="composer-actions">
                            <div class="composer-tools">
                                <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoSelect(event)">
                                <button class="composer-btn" onclick="document.getElementById('photoInput').click()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21,15 16,10 5,21"></polyline>
                                    </svg>
                                    <span>Photo</span>
                                </button>
                                <span id="photoPreview" class="photo-preview">Photo selected</span>
                            </div>
                            
                            <button class="btn primary" onclick="createPost()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                                </svg>
                                <span>Share Post</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="feedContent">
                    <div class="card welcome-card">
                        <div class="welcome-content">
                            <div class="welcome-icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                    <polyline points="3.27,6.96 12,12.01 20.73,6.96"></polyline>
                                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                </svg>
                            </div>
                            <h4>Welcome to DriveSphere</h4>
                            <p>Connect with fellow drivers and share your experiences on the road. Start by creating your first post!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Routes Page -->
            <div id="routes" class="page">
                <h2>üöó Routes & Tracking</h2>
                
                <!-- Route Tabs -->
                <div class="route-tabs" style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 1px solid rgba(0, 255, 255, 0.3);">
                    <button class="route-tab active" onclick="showRouteTab('tracking')" id="trackingTab">üìç Live Tracking</button>
                    <button class="route-tab" onclick="showRouteTab('history')" id="historyTab">üìä Route History</button>
                    <button class="route-tab" onclick="showRouteTab('shared')" id="sharedTab">üåê Shared Routes</button>
                </div>

                <!-- Live Tracking Tab -->
                <div id="trackingContent" class="route-content">
                    <div id="map" style="height: 400px; border-radius: 15px; margin: 1rem 0; border: 1px solid rgba(0, 255, 255, 0.3);"></div>
                    <div class="card">
                        <h3>üéØ Live Route Tracking</h3>
                        <div id="trackingStatus" style="margin: 1rem 0; padding: 1rem; background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 255, 0.1)); border-radius: 10px; border: 1px solid rgba(0, 255, 255, 0.3);">
                            <div id="trackingStatusText" style="font-size: 1.1rem; font-weight: 500;">Ready to start tracking</div>
                            <div id="trackingStats" style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.8;"></div>
                        </div>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn" id="trackingBtn" onclick="toggleTracking()">üöÄ Start Tracking</button>
                            <button class="btn admin" onclick="startFakeTracking()">üé≠ Fake Route (Test)</button>
                        </div>
                    </div>
                </div>

                <!-- Route History Tab -->
                <div id="historyContent" class="route-content" style="display: none;">
                    <div class="card">
                        <h3>üìà Your Route History</h3>
                        <div id="routeHistory">
                            <p style="opacity: 0.7;">No routes tracked yet. Start your first journey!</p>
                        </div>
                    </div>
                </div>

                <!-- Shared Routes Tab -->
                <div id="sharedContent" class="route-content" style="display: none;">
                    <div class="card">
                        <h3>üåê Community Routes</h3>
                        <div id="sharedRoutes">
                            <p style="opacity: 0.7;">No shared routes available. Share your first route!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analytics" class="page">
                <h2>Analytics</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="weeklyDistance">0</div>
                        <div class="stat-label">This Week (miles)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="monthlyDistance">0</div>
                        <div class="stat-label">This Month (miles)</div>
                    </div>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile" class="page">
                <h2>Profile</h2>
                
                <!-- User Info Card -->
                <div class="card">
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div class="user-avatar" id="profileAvatar" style="width: 60px; height: 60px; font-size: 1.5rem; margin-right: 1rem;">U</div>
                        <div>
                            <h3 id="profileName" style="margin: 0;">User Name</h3>
                            <p style="margin: 0.25rem 0; opacity: 0.8;">@<span id="profileUsername">username</span></p>
                        </div>
                    </div>
                    <p><strong>Email:</strong> <span id="profileEmail">user@example.com</span></p>
                    <p><strong>Member since:</strong> <span id="profileJoinDate">Today</span></p>
                </div>

                <!-- XP & Level Card -->
                <div class="card">
                    <h3>Level & XP</h3>
                    <div id="profileXPDisplay">
                        <!-- XP content will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Stats Card -->
                <div class="card">
                    <h3>Driving Stats</h3>
                    <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <div class="stat-card">
                            <div class="stat-value" id="profileTotalDistance">0</div>
                            <div class="stat-label">Total Miles</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="profileMaxSpeed">0</div>
                            <div class="stat-label">Max Speed (mph)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="profilePosts">0</div>
                            <div class="stat-label">Posts Shared</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="profileRoutes">0</div>
                            <div class="stat-label">Routes Tracked</div>
                        </div>
                    </div>
                </div>

                <!-- Achievements Card -->
                <div class="card">
                    <h3>Achievements</h3>
                    <div id="profileAchievements">
                        <p style="opacity: 0.7;">No achievements yet. Keep driving to unlock them!</p>
                    </div>
                </div>

                <!-- User's Posts -->
                <div class="card">
                    <h3>My Posts</h3>
                    <div id="userPosts">
                        <p style="opacity: 0.7;">No posts yet. Share your first driving experience!</p>
                    </div>
                </div>
            </div>

            <!-- Admin Page -->
            <div id="admin" class="page">
                <div class="admin-panel">
                    <h2>üîê Admin Panel</h2>
                    
                    <!-- Admin Stats Overview -->
                    <div class="admin-stats">
                        <div class="admin-stat">
                            <div class="stat-value" id="adminUserCount">0</div>
                            <div class="stat-label">Total Users</div>
                        </div>
                        <div class="admin-stat">
                            <div class="stat-value" id="adminPostCount">0</div>
                            <div class="stat-label">Total Posts</div>
                        </div>
                        <div class="admin-stat">
                            <div class="stat-value" id="adminRouteCount">0</div>
                            <div class="stat-label">Total Routes</div>
                        </div>
                        <div class="admin-stat">
                            <div class="stat-value" id="adminStorageUsed">0</div>
                            <div class="stat-label">Storage Used</div>
                        </div>
                    </div>

                    <!-- Admin Tabs -->
                    <div class="admin-tabs" style="display: flex; gap: 1rem; margin: 2rem 0; border-bottom: 1px solid rgba(0, 255, 255, 0.3);">
                        <button class="admin-tab active" onclick="showAdminTab('overview')" id="overviewTab">üìä Overview</button>
                        <button class="admin-tab" onclick="showAdminTab('users')" id="usersTab">üë• Users</button>
                        <button class="admin-tab" onclick="showAdminTab('posts')" id="postsTab">üìù Posts</button>
                        <button class="admin-tab" onclick="showAdminTab('routes')" id="routesTab">üó∫Ô∏è Routes</button>
                        <button class="admin-tab" onclick="showAdminTab('system')" id="systemTab">‚öôÔ∏è System</button>
                    </div>

                    <!-- Admin Content Areas -->
                    <div id="adminContent">
                        <!-- Overview Tab -->
                        <div id="overviewContent" class="admin-content">
                            <h3>üìä System Overview</h3>
                            <div class="card">
                                <h4>Recent Activity</h4>
                                <div id="recentActivity">
                                    <p>Loading recent activity...</p>
                                </div>
                            </div>
                            <div class="card">
                                <h4>Quick Actions</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                    <button class="btn secondary" onclick="exportAllData()">üì§ Export All Data</button>
                                    <button class="btn secondary" onclick="importData()">üì• Import Data</button>
                                    <button class="btn admin" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
                                    <button class="btn" onclick="refreshAdminStats()">üîÑ Refresh Stats</button>
                                </div>
                            </div>
                        </div>

                        <!-- Users Tab -->
                        <div id="usersContent" class="admin-content" style="display: none;">
                            <h3>üë• User Management</h3>
                            <div class="card">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h4>All Users</h4>
                                    <button class="btn secondary" onclick="refreshUsers()">üîÑ Refresh</button>
                                </div>
                                <div id="usersList">
                                    <p>Loading users...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Posts Tab -->
                        <div id="postsContent" class="admin-content" style="display: none;">
                            <h3>üìù Post Management</h3>
                            <div class="card">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h4>All Posts</h4>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn secondary" onclick="refreshPosts()">üîÑ Refresh</button>
                                        <button class="btn admin" onclick="deleteAllPosts()">üóëÔ∏è Delete All</button>
                                    </div>
                                </div>
                                <div id="postsList">
                                    <p>Loading posts...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Routes Tab -->
                        <div id="routesContent" class="admin-content" style="display: none;">
                            <h3>üó∫Ô∏è Route Management</h3>
                            <div class="card">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h4>All Routes</h4>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn secondary" onclick="refreshRoutes()">üîÑ Refresh</button>
                                        <button class="btn admin" onclick="deleteAllRoutes()">üóëÔ∏è Delete All</button>
                                    </div>
                                </div>
                                <div id="routesList">
                                    <p>Loading routes...</p>
                                </div>
                            </div>
                        </div>

                        <!-- System Tab -->
                        <div id="systemContent" class="admin-content" style="display: none;">
                            <h3>‚öôÔ∏è System Management</h3>
                            <div class="card">
                                <h4>Storage Information</h4>
                                <div id="storageInfo">
                                    <p>Loading storage information...</p>
                                </div>
                            </div>
                            <div class="card">
                                <h4>System Actions</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                    <button class="btn secondary" onclick="backupData()">üíæ Backup Data</button>
                                    <button class="btn secondary" onclick="restoreData()">üì• Restore Data</button>
                                    <button class="btn admin" onclick="resetSystem()">üîÑ Reset System</button>
                                    <button class="btn" onclick="generateReport()">üìä Generate Report</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Route Save Modal -->
    <div id="routeSaveModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üéØ Save Your Route</h3>
                <button class="modal-close" onclick="closeRouteSaveModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="route-stats-preview">
                    <h4>Route Statistics:</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Distance:</span>
                            <span class="stat-value" id="modalDistance">0.0 miles</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Duration:</span>
                            <span class="stat-value" id="modalDuration">0 minutes</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Points:</span>
                            <span class="stat-value" id="modalPoints">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Avg Speed:</span>
                            <span class="stat-value" id="modalAvgSpeed">0.0 mph</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="routeName">Route Name:</label>
                    <input type="text" id="routeName" placeholder="Enter a name for this route" value="">
                </div>
                
                <div class="form-group">
                    <label>Privacy Setting:</label>
                    <div class="privacy-options">
                        <label class="privacy-option">
                            <input type="radio" name="routePrivacy" value="private" checked>
                            <span class="privacy-icon">üîí</span>
                            <span>Private (Only you can see)</span>
                        </label>
                        <label class="privacy-option">
                            <input type="radio" name="routePrivacy" value="public">
                            <span class="privacy-icon">üåê</span>
                            <span>Public (Share with community)</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeRouteSaveModal()">Cancel</button>
                <button class="btn" onclick="saveRouteFromModal()">üíæ Save Route</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Global variables
        let currentUser = null;
        let isTracking = false;
        let map = null;
        let trackingInterval = null;
        let currentRoute = [];
        let watchId = null;

        // Utility functions for safe localStorage operations
        function safeSetItem(key, value) {
            try {
                if (!key || value === undefined) {
                    console.error('Invalid key or value for localStorage');
                    return false;
                }
                localStorage.setItem(key, JSON.stringify(value));
                return true;
            } catch (error) {
                console.error('‚ùå Error saving to localStorage:', error);
                // Try to clear some space if quota exceeded
                if (error.name === 'QuotaExceededError') {
                    console.warn('‚ö†Ô∏è localStorage quota exceeded, attempting to clear old data...');
                    try {
                        // Clear old posts and routes to make space
                        const posts = JSON.parse(localStorage.getItem('posts') || '[]');
                        const routes = JSON.parse(localStorage.getItem('routes') || '[]');
                        
                        if (posts.length > 50) {
                            localStorage.setItem('posts', JSON.stringify(posts.slice(-50)));
                        }
                        if (routes.length > 20) {
                            localStorage.setItem('routes', JSON.stringify(routes.slice(-20)));
                        }
                        
                        // Try again
                        localStorage.setItem(key, JSON.stringify(value));
                        return true;
                    } catch (retryError) {
                        console.error('‚ùå Failed to clear space and retry:', retryError);
                    }
                }
                return false;
            }
        }

        function safeGetItem(key) {
            try {
                if (!key) {
                    console.error('‚ùå Invalid key for localStorage');
                    return null;
                }
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : null;
            } catch (error) {
                console.error('‚ùå Error reading from localStorage:', error);
                return null;
            }
        }
        let lastPosition = null;
        let totalDistance = 0;
        let sessionStartTime = null;
        let speedData = [];
        let gForceData = [];
        let currentXP = 0;
        let currentLevel = 1;
        let achievements = [];

        // XP System Configuration
        const XP_CONFIG = {
            LEVELS: [
                { level: 1, xpRequired: 0, title: "New Driver" },
                { level: 2, xpRequired: 100, title: "Rookie" },
                { level: 3, xpRequired: 250, title: "Apprentice" },
                { level: 4, xpRequired: 500, title: "Experienced" },
                { level: 5, xpRequired: 1000, title: "Expert" },
                { level: 6, xpRequired: 2000, title: "Master" },
                { level: 7, xpRequired: 3500, title: "Legend" },
                { level: 8, xpRequired: 5000, title: "Champion" },
                { level: 9, xpRequired: 7500, title: "Elite" },
                { level: 10, xpRequired: 10000, title: "Grandmaster" }
            ],
            ACHIEVEMENTS: {
                first_drive: { name: "First Drive", description: "Complete your first drive", xp: 50, unlocked: false },
                speed_demon: { name: "Speed Demon", description: "Reach 100+ mph", xp: 500, unlocked: false },
                marathon_driver: { name: "Marathon Driver", description: "Drive for 2+ hours straight", xp: 300, unlocked: false },
                distance_master: { name: "Distance Master", description: "Drive 100+ miles in one session", xp: 400, unlocked: false },
                daily_driver: { name: "Daily Driver", description: "Drive 7 days in a row", xp: 200, unlocked: false },
                social_butterfly: { name: "Social Butterfly", description: "Share 10 posts", xp: 150, unlocked: false },
                route_explorer: { name: "Route Explorer", description: "Track 5 different routes", xp: 250, unlocked: false },
                g_force_warrior: { name: "G-Force Warrior", description: "Experience 2+ G's", xp: 300, unlocked: false }
            },
            XP_SOURCES: {
                MILE_DRIVEN: 10,        // 10 XP per mile
                HOUR_DRIVEN: 50,        // 50 XP per hour
                SPEED_BONUS: 0.5,       // 0.5 XP per mph over 60
                POST_SHARED: 25,        // 25 XP per post
                ROUTE_TRACKED: 100      // 100 XP per route
            }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DriveSphere starting...');
            checkAuthStatus();
            initializeEventListeners();
        });

        function checkAuthStatus() {
            console.log('Checking auth status...');
            
            // Check if user is logged in from localStorage
            const savedUser = safeGetItem('currentUser');
            const rememberMe = safeGetItem('rememberMe') === true;
            
            if (savedUser && rememberMe) {
                try {
                    currentUser = savedUser;
                    console.log('User found in localStorage:', currentUser.email);
                    showMainApp();
                    updateUserUI();
                    initializeApp();
                } catch (error) {
                    console.error('‚ùå Error loading saved user:', error);
                    showAuthContainer();
                }
            } else {
                console.log('No saved user or remember me not set');
                showAuthContainer();
            }
        }

        function initializeEventListeners() {
            // Login form
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
            
            // Register form
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', handleRegister);
            }
            
            // Admin login form
            const adminLoginForm = document.getElementById('adminLoginForm');
            if (adminLoginForm) {
                adminLoginForm.addEventListener('submit', handleAdminLogin);
            }
            
            // Username availability check with debouncing
            const registerUsername = document.getElementById('registerUsername');
            if (registerUsername) {
                registerUsername.addEventListener('input', debounce(checkUsernameAvailability, 300));
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            const emailInput = document.getElementById('loginEmail');
            const passwordInput = document.getElementById('loginPassword');
            const rememberMeInput = document.getElementById('rememberMe');
            
            if (!emailInput || !passwordInput || !rememberMeInput) {
                console.error('Login form elements not found');
                return;
            }
            
            const email = emailInput.value;
            const password = passwordInput.value;
            const rememberMe = rememberMeInput.checked;

            console.log('Attempting login for:', email);

            // Simple validation
            if (!email || !password) {
                alert('Please fill in all fields');
                return;
            }

            // Check if user exists in localStorage
            const users = safeGetItem('users') || [];
            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                console.log('‚úÖ Login successful');
                currentUser = user;
                
                // Save login state
                if (rememberMe) {
                    safeSetItem('currentUser', user);
                    safeSetItem('rememberMe', true);
                    console.log('üíæ User saved for persistence');
                } else {
                    safeSetItem('currentUser', user);
                    safeSetItem('rememberMe', false);
                    console.log('üíæ User saved for session only');
                }

                showMainApp();
                updateUserUI();
                initializeApp();
            } else {
                alert('Invalid email or password');
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            const nameInput = document.getElementById('registerName');
            const usernameInput = document.getElementById('registerUsername');
            const emailInput = document.getElementById('registerEmail');
            const passwordInput = document.getElementById('registerPassword');
            
            if (!nameInput || !usernameInput || !emailInput || !passwordInput) {
                console.error('‚ùå Registration form elements not found');
                return;
            }
            
            const name = nameInput.value;
            const username = usernameInput.value;
            const email = emailInput.value;
            const password = passwordInput.value;

            console.log('üìù Attempting registration for:', email);

            // Check if username is available
            const users = safeGetItem('users') || [];
            const usernameTaken = users.some(u => u.username && u.username.toLowerCase() === username.toLowerCase());
            
            if (usernameTaken) {
                alert('Username is already taken');
                return;
            }

            // Create new user
            const newUser = {
                id: Date.now().toString(),
                name: name,
                username: username,
                email: email,
                password: password,
                createdAt: new Date().toISOString(),
                stats: {
                    totalDistance: 0,
                    totalTime: 0,
                    avgSpeed: 0,
                    maxSpeed: 0
                }
            };

            // Save user
            users.push(newUser);
            if (!safeSetItem('users', users)) {
                alert('Failed to save user data. Please try again.');
                return;
            }

            console.log('‚úÖ Registration successful');
            currentUser = newUser;
            safeSetItem('currentUser', newUser);
            safeSetItem('rememberMe', true);

            showMainApp();
            updateUserUI();
            initializeApp();
        }

        function handleAdminLogin(event) {
            event.preventDefault();
            const adminKeyInput = document.getElementById('adminKey');
            
            if (!adminKeyInput) {
                console.error('‚ùå Admin key input not found');
                return;
            }
            
            const adminKey = adminKeyInput.value;

            if (adminKey === '5478') {
                console.log('‚úÖ Admin login successful');
                currentUser = {
                    id: 'admin',
                    name: 'Admin',
                    username: 'admin',
                    email: 'admin@drivesphere.com',
                    isAdmin: true
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                localStorage.setItem('rememberMe', 'true');

                showMainApp();
                updateUserUI();
                initializeApp();
                showPage('admin');
            } else {
                alert('Invalid admin key');
            }
        }

        // Debounce function for performance
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function checkUsernameAvailability() {
            const usernameInput = document.getElementById('registerUsername');
            const statusDiv = document.getElementById('usernameStatus');
            const registerForm = document.getElementById('registerForm');
            
            if (!usernameInput || !statusDiv || !registerForm) {
                console.error('‚ùå Username availability check elements not found');
                return;
            }
            
            const username = usernameInput.value.trim();
            const registerBtn = registerForm.querySelector('button[type="submit"]');

            if (!username) {
                statusDiv.innerHTML = '';
                return;
            }

            if (username.length < 3) {
                statusDiv.innerHTML = '<span style="color: #ff6b6b;">Username must be at least 3 characters</span>';
                registerBtn.disabled = true;
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const usernameTaken = users.some(u => u.username && u.username.toLowerCase() === username.toLowerCase());

            if (usernameTaken) {
                statusDiv.innerHTML = '<span style="color: #ff6b6b;">‚ùå Username taken</span>';
                registerBtn.disabled = true;
            } else {
                statusDiv.innerHTML = '<span style="color: #51cf66;">‚úÖ Username available</span>';
                registerBtn.disabled = false;
            }
        }

        function showMainApp() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('adminLoginModal').classList.add('hidden');
            document.getElementById('registerContainer').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            console.log('Main app shown');
        }

        function showAuthContainer() {
            document.getElementById('authContainer').classList.remove('hidden');
            document.getElementById('adminLoginModal').classList.add('hidden');
            document.getElementById('registerContainer').classList.add('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            console.log('üîê Auth container shown');
        }

        function showAdminLogin() {
            document.getElementById('adminLoginModal').classList.remove('hidden');
            document.getElementById('authContainer').classList.add('hidden');
        }

        function hideAdminLogin() {
            document.getElementById('adminLoginModal').classList.add('hidden');
            document.getElementById('authContainer').classList.remove('hidden');
        }

        function switchToRegister() {
            document.getElementById('registerContainer').classList.remove('hidden');
            document.getElementById('authContainer').classList.add('hidden');
        }

        function switchToLogin() {
            document.getElementById('registerContainer').classList.add('hidden');
            document.getElementById('authContainer').classList.remove('hidden');
        }

        function updateUserUI() {
            if (!currentUser) {
                console.warn('‚ö†Ô∏è No current user to update UI');
                return;
            }
            
            try {
                const userDisplayName = document.getElementById('userDisplayName');
                const userAvatar = document.getElementById('userAvatar');
                const profileName = document.getElementById('profileName');
                const profileUsername = document.getElementById('profileUsername');
                const profileEmail = document.getElementById('profileEmail');
                const profileJoinDate = document.getElementById('profileJoinDate');
                const profileAvatar = document.getElementById('profileAvatar');
                
                if (userDisplayName) userDisplayName.textContent = `@${currentUser.username}`;
                if (userAvatar) userAvatar.textContent = currentUser.name.charAt(0).toUpperCase();
                if (profileName) profileName.textContent = currentUser.name;
                if (profileUsername) profileUsername.textContent = currentUser.username;
                if (profileEmail) profileEmail.textContent = currentUser.email;
                if (profileJoinDate) profileJoinDate.textContent = new Date(currentUser.createdAt).toLocaleDateString();
                if (profileAvatar) profileAvatar.textContent = currentUser.name.charAt(0).toUpperCase();
                
                // Update composer avatar
                const composerAvatar = document.getElementById('composerAvatar');
                if (composerAvatar) {
                    composerAvatar.textContent = currentUser.name.charAt(0).toUpperCase();
                }
                
                // Update profile stats
                updateProfileStats();
                updateProfileXP();
                updateProfileAchievements();
                loadUserPosts();
                
                if (currentUser.isAdmin) {
                    // Add admin page to navigation
                    const navLinks = document.querySelector('.nav-links');
                    if (!document.querySelector('[onclick="showPage(\'admin\')"]')) {
                        const adminLi = document.createElement('li');
                        adminLi.innerHTML = '<span onclick="showPage(\'admin\')">Admin</span>';
                        navLinks.appendChild(adminLi);
                    }
                }
            } catch (error) {
                console.error('Error updating user UI:', error);
            }
        }

        function updateProfileStats() {
            if (currentUser) {
                const stats = currentUser.stats || {};
                document.getElementById('profileTotalDistance').textContent = (stats.totalDistance || 0).toFixed(1);
                document.getElementById('profileMaxSpeed').textContent = (stats.maxSpeed || 0).toFixed(1);
                
                // Count posts
                const posts = JSON.parse(localStorage.getItem('posts') || '[]');
                const userPosts = posts.filter(p => p.userId === currentUser.id);
                document.getElementById('profilePosts').textContent = userPosts.length;
                
                // Count routes
                const routes = JSON.parse(localStorage.getItem('routes') || '[]');
                const userRoutes = routes.filter(r => r.userId === currentUser.id);
                document.getElementById('profileRoutes').textContent = userRoutes.length;
            }
        }

        function updateProfileXP() {
            if (currentUser) {
                const currentLevelData = XP_CONFIG.LEVELS.find(l => l.level === currentLevel);
                const nextLevelData = XP_CONFIG.LEVELS.find(l => l.level === currentLevel + 1);
                
                if (currentLevelData) {
                    const xpForCurrentLevel = currentXP - currentLevelData.xpRequired;
                    const xpNeededForNext = nextLevelData ? nextLevelData.xpRequired - currentLevelData.xpRequired : 0;
                    const progress = nextLevelData ? (xpForCurrentLevel / xpNeededForNext) * 100 : 100;
                    
                    document.getElementById('profileXPDisplay').innerHTML = `
                        <div style="text-align: center;">
                            <h4>Level ${currentLevel} - ${currentLevelData.title}</h4>
                            <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 0.5rem; margin: 0.5rem 0;">
                                <div style="background: linear-gradient(90deg, #ffd93d, #ff6b6b); height: 15px; border-radius: 10px; width: ${progress}%; transition: width 0.3s;"></div>
                            </div>
                            <p style="margin: 0; font-size: 0.9rem; opacity: 0.8;">${currentXP} XP (${xpForCurrentLevel}/${xpNeededForNext} to next level)</p>
                        </div>
                    `;
                }
            }
        }

        function updateProfileAchievements() {
            if (currentUser) {
                const achievements = currentUser.achievements || {};
                const achievementHTML = Object.entries(XP_CONFIG.ACHIEVEMENTS).map(([key, achievement]) => {
                    const isUnlocked = achievements[key] || false;
                    return `
                        <div style="display: flex; align-items: center; padding: 0.5rem; margin: 0.25rem 0; background: rgba(255,255,255,0.05); border-radius: 8px; ${isUnlocked ? 'border-left: 3px solid #51cf66;' : ''}">
                            <div style="font-size: 1.2rem; margin-right: 0.5rem;">${isUnlocked ? 'üèÜ' : 'üîí'}</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 500; ${isUnlocked ? 'color: #51cf66;' : 'opacity: 0.5;'}">${achievement.name}</div>
                                <div style="font-size: 0.8rem; opacity: 0.7;">${achievement.description}</div>
                            </div>
                            <div style="font-size: 0.8rem; opacity: 0.7;">+${achievement.xp} XP</div>
                        </div>
                    `;
                }).join('');
                
                document.getElementById('profileAchievements').innerHTML = achievementHTML || '<p style="opacity: 0.7;">No achievements yet. Keep driving to unlock them!</p>';
            }
        }

        function loadUserPosts() {
            if (currentUser) {
                const posts = JSON.parse(localStorage.getItem('posts') || '[]');
                const userPosts = posts.filter(p => p.userId === currentUser.id).reverse();
                
                if (userPosts.length === 0) {
                    document.getElementById('userPosts').innerHTML = '<p style="opacity: 0.7;">No posts yet. Share your first driving experience!</p>';
                    return;
                }
                
                let postsHTML = '';
                userPosts.forEach(post => {
                    postsHTML += `
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; margin: 0.5rem 0; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <small style="opacity: 0.7;">${new Date(post.timestamp).toLocaleString()}</small>
                            </div>
                            ${post.content ? `<p style="margin: 0.5rem 0;">${post.content}</p>` : ''}
                            ${post.photo ? `<img src="${post.photo}" style="width: 100%; max-width: 300px; border-radius: 8px; margin: 0.5rem 0;" alt="Post photo">` : ''}
                        </div>
                    `;
                });
                
                document.getElementById('userPosts').innerHTML = postsHTML;
            }
        }

        function initializeApp() {
            console.log('üîß Initializing app...');
            loadUserStats();
            loadFeed();
            loadXPData();
            initializeGForceMonitoring();
            
            // Initialize map with a delay to ensure DOM is ready
            setTimeout(() => {
                initializeMap();
            }, 500);
        }

        // XP System Functions
        function loadXPData() {
            if (currentUser) {
                currentXP = currentUser.xp || 0;
                currentLevel = currentUser.level || 1;
                achievements = currentUser.achievements || {};
                updateXPDisplay();
            }
        }

        function addXP(amount, source) {
            if (!currentUser) return;
            
            currentXP += amount;
            currentUser.xp = currentXP;
            
            // Check for level up
            const newLevel = calculateLevel(currentXP);
            if (newLevel > currentLevel) {
                currentLevel = newLevel;
                currentUser.level = currentLevel;
                showLevelUpAnimation();
            }
            
            // Check achievements
            checkAchievements(source);
            
            // Save to localStorage
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            updateXPDisplay();
            console.log(`üéâ +${amount} XP (${source})`);
        }

        function calculateLevel(xp) {
            for (let i = XP_CONFIG.LEVELS.length - 1; i >= 0; i--) {
                if (xp >= XP_CONFIG.LEVELS[i].xpRequired) {
                    return XP_CONFIG.LEVELS[i].level;
                }
            }
            return 1;
        }

        function updateXPDisplay() {
            const currentLevelData = XP_CONFIG.LEVELS.find(l => l.level === currentLevel);
            const nextLevelData = XP_CONFIG.LEVELS.find(l => l.level === currentLevel + 1);
            
            if (currentLevelData) {
                const xpForCurrentLevel = currentXP - currentLevelData.xpRequired;
                const xpNeededForNext = nextLevelData ? nextLevelData.xpRequired - currentLevelData.xpRequired : 0;
                const progress = nextLevelData ? (xpForCurrentLevel / xpNeededForNext) * 100 : 100;
                
                // Update XP display in dashboard
                const xpDisplay = document.getElementById('xpDisplay');
                if (xpDisplay) {
                    xpDisplay.innerHTML = `
                        <div style="text-align: center; margin: 1rem 0;">
                            <h3>Level ${currentLevel} - ${currentLevelData.title}</h3>
                            <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 0.5rem; margin: 0.5rem 0;">
                                <div style="background: linear-gradient(90deg, #ffd93d, #ff6b6b); height: 20px; border-radius: 10px; width: ${progress}%; transition: width 0.3s;"></div>
                            </div>
                            <p>${currentXP} XP (${xpForCurrentLevel}/${xpNeededForNext} to next level)</p>
                        </div>
                    `;
                }
            }
        }

        function showLevelUpAnimation() {
            const currentLevelData = XP_CONFIG.LEVELS.find(l => l.level === currentLevel);
            if (currentLevelData) {
                // Create level up notification
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background: linear-gradient(45deg, #ffd93d, #ff6b6b); color: white;
                    padding: 2rem; border-radius: 15px; text-align: center;
                    font-size: 1.5rem; font-weight: bold; z-index: 1000;
                    box-shadow: 0 0 30px rgba(255, 215, 61, 0.8);
                    animation: levelUpPulse 2s ease-in-out;
                `;
                notification.innerHTML = `
                    <div>üéâ LEVEL UP! üéâ</div>
                    <div style="font-size: 1.2rem; margin-top: 0.5rem;">Level ${currentLevel} - ${currentLevelData.title}</div>
                `;
                
                // Add animation keyframes
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes levelUpPulse {
                        0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
                
                document.body.appendChild(notification);
                setTimeout(() => {
                    document.body.removeChild(notification);
                    document.head.removeChild(style);
                }, 2000);
            }
        }

        function checkAchievements(source) {
            if (!currentUser) return;
            
            let newAchievements = [];
            
            // Check various achievements
            if (source === 'first_drive' && !achievements.first_drive) {
                achievements.first_drive = true;
                newAchievements.push('first_drive');
            }
            
            if (speedData.some(speed => speed > 100) && !achievements.speed_demon) {
                achievements.speed_demon = true;
                newAchievements.push('speed_demon');
            }
            
            if (totalDistance > 100 && !achievements.distance_master) {
                achievements.distance_master = true;
                newAchievements.push('distance_master');
            }
            
            if (gForceData.some(g => g > 2) && !achievements.g_force_warrior) {
                achievements.g_force_warrior = true;
                newAchievements.push('g_force_warrior');
            }
            
            // Show achievement notifications
            newAchievements.forEach(achievementId => {
                const achievement = XP_CONFIG.ACHIEVEMENTS[achievementId];
                if (achievement) {
                    addXP(achievement.xp, 'achievement');
                    showAchievementNotification(achievement);
                }
            });
            
            currentUser.achievements = achievements;
        }

        function showAchievementNotification(achievement) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; background: linear-gradient(45deg, #51cf66, #40c057);
                color: white; padding: 1rem; border-radius: 10px; z-index: 1000;
                box-shadow: 0 4px 15px rgba(81, 207, 102, 0.3);
                animation: slideIn 0.5s ease-out;
            `;
            notification.innerHTML = `
                <div style="font-weight: bold;">üèÜ Achievement Unlocked!</div>
                <div>${achievement.name}</div>
                <div style="font-size: 0.8rem; opacity: 0.9;">+${achievement.xp} XP</div>
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            setTimeout(() => {
                document.body.removeChild(notification);
                document.head.removeChild(style);
            }, 3000);
        }

        function loadUserStats() {
            if (currentUser && currentUser.stats) {
                document.getElementById('totalDistance').textContent = currentUser.stats.totalDistance || 0;
                document.getElementById('totalTime').textContent = currentUser.stats.totalTime || 0;
                document.getElementById('avgSpeed').textContent = currentUser.stats.avgSpeed || 0;
                document.getElementById('maxSpeed').textContent = currentUser.stats.maxSpeed || 0;
            }
        }

        function loadFeed() {
            try {
                const posts = safeGetItem('posts') || [];
                const feedContent = document.getElementById('feedContent');
                
                if (!feedContent) {
                    console.error('‚ùå Feed content container not found');
                    return;
                }
            
            if (posts.length === 0) {
                feedContent.innerHTML = `
                    <div class="card welcome-card">
                        <div class="welcome-content">
                            <div class="welcome-icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                    <polyline points="3.27,6.96 12,12.01 20.73,6.96"></polyline>
                                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                </svg>
                            </div>
                            <h4>Welcome to DriveSphere</h4>
                            <p>Connect with fellow drivers and share your experiences on the road. Start by creating your first post!</p>
                        </div>
                    </div>
                `;
                return;
            }

            let feedHTML = '';
            posts.reverse().forEach(post => {
                const canDelete = currentUser && (currentUser.id === post.userId || currentUser.isAdmin);
                const timeAgo = getTimeAgo(new Date(post.timestamp));
                
                feedHTML += `
                    <div class="card post-card">
                        <div class="post-header">
                            <div class="post-user">
                                <div class="user-avatar">${post.username.charAt(0).toUpperCase()}</div>
                                <div class="user-info">
                                    <h4 class="username">${post.username}</h4>
                                    <span class="post-time">${timeAgo}</span>
                                </div>
                            </div>
                            ${canDelete ? `
                                <button class="delete-btn" onclick="deletePost('${post.id}')" title="Delete post">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,6 5,6 21,6"></polyline>
                                        <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                                    </svg>
                                </button>
                            ` : ''}
                        </div>
                        <div class="post-content">
                            ${post.content ? `<p class="post-text">${post.content}</p>` : ''}
                            ${post.photo ? `<img src="${post.photo}" class="post-image" alt="Post photo">` : ''}
                        </div>
                        <div class="post-actions">
                            <button class="action-btn like-btn" onclick="toggleLike('${post.id}')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                </svg>
                                <span>Like</span>
                            </button>
                            <button class="action-btn comment-btn" onclick="toggleComments('${post.id}')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span>Comment</span>
                            </button>
                            <button class="action-btn share-btn" onclick="sharePost('${post.id}')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="18" cy="5" r="3"></circle>
                                    <circle cx="6" cy="12" r="3"></circle>
                                    <circle cx="18" cy="19" r="3"></circle>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                                </svg>
                                <span>Share</span>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            feedContent.innerHTML = feedHTML;
            } catch (error) {
                console.error('‚ùå Error loading feed:', error);
                const feedContent = document.getElementById('feedContent');
                if (feedContent) {
                    feedContent.innerHTML = '<div class="card"><p>Error loading feed. Please refresh the page.</p></div>';
                }
            }
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)}d ago`;
            return date.toLocaleDateString();
        }

        let selectedPhoto = null;

        function handlePhotoSelect(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    alert('Photo is too large. Please select a photo under 5MB.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    selectedPhoto = e.target.result;
                    const photoPreview = document.getElementById('photoPreview');
                    photoPreview.style.display = 'inline';
                    photoPreview.textContent = `Photo selected: ${file.name}`;
                    console.log('üì∑ Photo selected:', file.name);
                };
                reader.readAsDataURL(file);
            }
        }

        function createPost() {
            try {
                const postContentInput = document.getElementById('postContent');
                if (!postContentInput) {
                    console.error('‚ùå Post content input not found');
                    return;
                }
                
                const content = postContentInput.value.trim();
                if (!content && !selectedPhoto) {
                    alert('Please enter some content or select a photo');
                    return;
                }

                const posts = safeGetItem('posts') || [];
            const newPost = {
                id: Date.now().toString(),
                userId: currentUser.id,
                username: currentUser.username,
                content: content,
                photo: selectedPhoto,
                timestamp: new Date().toISOString()
            };

            posts.push(newPost);
            if (!safeSetItem('posts', posts)) {
                alert('Failed to save post. Please try again.');
                return;
            }
            
            // Clear form
            postContentInput.value = '';
            selectedPhoto = null;
            const photoPreview = document.getElementById('photoPreview');
            const photoInput = document.getElementById('photoInput');
            if (photoPreview) photoPreview.style.display = 'none';
            if (photoInput) photoInput.value = '';
            
            // Add XP for sharing
            addXP(XP_CONFIG.XP_SOURCES.POST_SHARED, 'post_shared');
            
            loadFeed();
            } catch (error) {
                console.error('‚ùå Error creating post:', error);
                alert('Failed to create post. Please try again.');
            }
        }

        function deletePost(postId) {
            if (!currentUser) return;
            
            try {
                const posts = safeGetItem('posts') || [];
            const post = posts.find(p => p.id === postId);
            
            if (!post) {
                alert('Post not found');
                return;
            }
            
            // Check if user can delete this post
            const canDelete = currentUser.id === post.userId || currentUser.isAdmin;
            if (!canDelete) {
                alert('You can only delete your own posts');
                return;
            }
            
            if (confirm(`Are you sure you want to delete this post?\n\n"${post.content.substring(0, 50)}${post.content.length > 50 ? '...' : ''}"`)) {
            const updatedPosts = posts.filter(p => p.id !== postId);
            if (!safeSetItem('posts', updatedPosts)) {
                alert('Failed to delete post. Please try again.');
                return;
            }
            
            console.log('üóëÔ∏è Post deleted:', postId);
            loadFeed();
            loadUserPosts(); // Refresh user's posts in profile
            } catch (error) {
                console.error('‚ùå Error deleting post:', error);
                alert('Failed to delete post. Please try again.');
            }
            }
        }

        function toggleLike(postId) {
            // Placeholder for like functionality
            console.log('Like toggled for post:', postId);
        }

        function toggleComments(postId) {
            // Placeholder for comment functionality
            console.log('Comments toggled for post:', postId);
        }

        function sharePost(postId) {
            // Placeholder for share functionality
            console.log('Share post:', postId);
        }

        function initializeMap() {
            if (map) {
                console.log('üó∫Ô∏è Map already initialized');
                return;
            }
            
            console.log('üó∫Ô∏è Initializing map...');
            
            try {
                // Check if map container exists
                const mapContainer = document.getElementById('map');
                if (!mapContainer) {
                    console.error('‚ùå Map container not found');
                    return;
                }
                
                // Initialize map with better performance settings
                map = L.map('map', {
                    center: [37.7749, -122.4194],
                    zoom: 13,
                    zoomControl: true,
                    preferCanvas: true, // Better performance
                    renderer: L.canvas() // Use canvas renderer
                });
                
                // Add tile layer with performance optimizations
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 19,
                    subdomains: ['a', 'b', 'c'],
                    updateWhenIdle: false, // Don't wait for idle
                    keepBuffer: 2, // Keep fewer tiles in buffer
                    updateWhenZooming: false // Don't update while zooming
                }).addTo(map);
                
                console.log('‚úÖ Map initialized successfully');
                
                // Try to get user's current location and update map
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            map.setView([lat, lng], 13);
                            console.log('üìç Map centered on user location:', lat, lng);
                        },
                        error => {
                            console.log('üìç Could not get user location, using default');
                        },
                        {
                            enableHighAccuracy: false, // Faster, less accurate
                            timeout: 3000, // Shorter timeout
                            maximumAge: 600000 // 10 minutes cache
                        }
                    );
                }
                
                // Add map ready event
                map.whenReady(() => {
                    console.log('üó∫Ô∏è Map is ready for use');
                    // Force a redraw to ensure proper rendering
                    setTimeout(() => {
                        map.invalidateSize();
                    }, 100);
                });
                
            } catch (error) {
                console.error('‚ùå Error initializing map:', error);
            }
        }

        function refreshMap() {
            if (map) {
                map.invalidateSize();
                console.log('üó∫Ô∏è Map refreshed');
            }
        }

        function toggleTracking() {
            if (isTracking) {
                stopTracking();
            } else {
                startTracking();
            }
        }

        function startTracking() {
            if (isTracking) return;
            
            console.log('Starting tracking...');
            
            try {
                // Update UI
                const trackingBtn = document.getElementById('trackingBtn');
                const statusText = document.getElementById('trackingStatusText');
                
                if (!trackingBtn || !statusText) {
                    console.error('‚ùå Tracking UI elements not found');
                    return;
                }
                
                trackingBtn.textContent = '‚èπÔ∏è Stop Tracking';
                trackingBtn.classList.add('secondary');
                statusText.textContent = 'Requesting location permission...';
                statusText.style.color = '#ffd93d';
            
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by this browser.');
                resetTrackingButton();
                return;
            }
            
            // First, request permission with getCurrentPosition
            navigator.geolocation.getCurrentPosition(
                position => {
                    console.log('‚úÖ Location permission granted');
                    startActualTracking();
                },
                error => {
                    console.error('‚ùå Location permission denied:', error);
                    let errorMessage = 'Location access denied. ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'Please allow location access in your browser settings and try again.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'Location information is unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'Location request timed out.';
                            break;
                        default:
                            errorMessage += 'An unknown error occurred.';
                            break;
                    }
                    alert(errorMessage);
                    document.getElementById('trackingStatusText').textContent = 'Location permission required';
                    document.getElementById('trackingStatusText').style.color = '#ff6b6b';
                    resetTrackingButton();
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
            } catch (error) {
                console.error('‚ùå Error starting tracking:', error);
                resetTrackingButton();
                const statusText = document.getElementById('trackingStatusText');
                if (statusText) {
                    statusText.textContent = 'Error starting tracking';
                    statusText.style.color = '#ef4444';
                }
            }
        }

        function resetTrackingButton() {
            const trackingBtn = document.getElementById('trackingBtn');
            if (trackingBtn) {
                trackingBtn.textContent = 'üöÄ Start Tracking';
                trackingBtn.classList.remove('secondary');
            }
        }

        function startActualTracking() {
            isTracking = true;
            currentRoute = [];
            sessionStartTime = new Date();
            totalDistance = 0;
            speedData = [];
            gForceData = [];
            
            console.log('üìç Starting actual tracking...');
            
            // Update UI
            document.getElementById('trackingStatusText').textContent = 'Tracking started - Getting location...';
            document.getElementById('trackingStatusText').style.color = '#51cf66';
            
            // Use watchPosition for continuous tracking
            watchId = navigator.geolocation.watchPosition(
                position => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const speed = position.coords.speed || 0; // m/s
                    const speedMph = speed * 2.237; // Convert to mph
                    
                    console.log(`üìç Location: ${lat}, ${lng}, Speed: ${speedMph.toFixed(1)} mph`);
                    
                    // Calculate distance from last position
                    if (lastPosition) {
                        const distance = calculateDistance(
                            lastPosition.lat, lastPosition.lng,
                            lat, lng
                        );
                        totalDistance += distance;
                        
                        // Add XP for distance
                        addXP(distance * XP_CONFIG.XP_SOURCES.MILE_DRIVEN, 'mile_driven');
                    }
                    
                    // Store position and speed data
                    currentRoute.push([lat, lng]);
                    speedData.push(speedMph);
                    lastPosition = { lat, lng, timestamp: Date.now() };
                    
                    // Update map
                    if (map) {
                        map.setView([lat, lng], 15);
                        
                        // Clear previous markers and add new one
                        map.eachLayer(layer => {
                            if (layer instanceof L.Marker) {
                                map.removeLayer(layer);
                            }
                        });
                        
                        L.marker([lat, lng]).addTo(map);
                        
                        // Draw route line
                        if (currentRoute.length > 1) {
                            L.polyline(currentRoute, {color: '#00ffff', weight: 3}).addTo(map);
                        }
                    }
                    
                    // Update tracking status
                    document.getElementById('trackingStatusText').textContent = `üìç Tracking active - ${currentRoute.length} points`;
                    document.getElementById('trackingStatusText').style.color = '#51cf66';
                    
                    // Update stats
                    updateTrackingStats();
                    
                    // Check for achievements
                    checkAchievements('tracking');
                    
                },
                error => {
                    console.error('‚ùå GPS watch error:', error);
                    document.getElementById('trackingStatusText').textContent = 'GPS tracking failed. Please check location permissions.';
                    document.getElementById('trackingStatusText').style.color = '#ff6b6b';
                    stopTracking();
                },
                {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 1000
                }
            );
        }

        function startFakeTracking() {
            if (isTracking) return;
            
            console.log('üé≠ Starting fake tracking for testing...');
            
            // Update UI
            document.getElementById('trackingBtn').textContent = '‚èπÔ∏è Stop Tracking';
            document.getElementById('trackingBtn').classList.add('secondary');
            document.getElementById('trackingStatusText').textContent = 'Starting fake route simulation...';
            document.getElementById('trackingStatusText').style.color = '#ffd93d';
            
            isTracking = true;
            currentRoute = [];
            sessionStartTime = new Date();
            totalDistance = 0;
            speedData = [];
            gForceData = [];
            
            // Create a fake route around San Francisco
            const fakeRoute = [
                [37.7749, -122.4194], // Union Square
                [37.7849, -122.4094], // North
                [37.7849, -122.4294], // East
                [37.7649, -122.4294], // South
                [37.7649, -122.4094], // West
                [37.7749, -122.4194]  // Back to start
            ];
            
            let pointIndex = 0;
            const fakeInterval = setInterval(() => {
                if (!isTracking || pointIndex >= fakeRoute.length) {
                    clearInterval(fakeInterval);
                    if (isTracking) {
                        stopTracking();
                    }
                    return;
                }
                
                const [lat, lng] = fakeRoute[pointIndex];
                const speed = 25 + Math.random() * 15; // Random speed between 25-40 mph
                
                console.log(`üé≠ Fake location: ${lat}, ${lng}, Speed: ${speed.toFixed(1)} mph`);
                
                // Calculate distance from last position
                if (lastPosition) {
                    const distance = calculateDistance(
                        lastPosition.lat, lastPosition.lng,
                        lat, lng
                    );
                    totalDistance += distance;
                    
                    // Add XP for distance
                    addXP(distance * XP_CONFIG.XP_SOURCES.MILE_DRIVEN, 'mile_driven');
                }
                
                // Store position and speed data
                currentRoute.push([lat, lng]);
                speedData.push(speed);
                lastPosition = { lat, lng, timestamp: Date.now() };
                
                // Update map
                if (map) {
                    map.setView([lat, lng], 15);
                    
                    // Clear previous markers and add new one
                    map.eachLayer(layer => {
                        if (layer instanceof L.Marker) {
                            map.removeLayer(layer);
                        }
                    });
                    
                    L.marker([lat, lng]).addTo(map);
                    
                    // Draw route line
                    if (currentRoute.length > 1) {
                        L.polyline(currentRoute, {color: '#ff00ff', weight: 3}).addTo(map);
                    }
                }
                
                // Update tracking status
                document.getElementById('trackingStatusText').textContent = `üé≠ Fake tracking - ${currentRoute.length} points`;
                document.getElementById('trackingStatusText').style.color = '#ff00ff';
                
                // Update stats
                updateTrackingStats();
                
                // Check for achievements
                checkAchievements('tracking');
                
                pointIndex++;
            }, 2000); // Add a point every 2 seconds
            
            // Store interval ID for cleanup
            window.fakeTrackingInterval = fakeInterval;
        }

        function stopTracking() {
            if (!isTracking) return;
            
            isTracking = false;
            
            // Update UI
            resetTrackingButton();
            document.getElementById('trackingStatusText').textContent = 'Tracking stopped';
            document.getElementById('trackingStatusText').style.color = '#ff6b6b';
            
            // Clear real GPS tracking
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
            
            // Clear fake tracking interval
            if (window.fakeTrackingInterval) {
                clearInterval(window.fakeTrackingInterval);
                window.fakeTrackingInterval = null;
            }
            
            // Calculate session time and add XP
            if (sessionStartTime) {
                const sessionTime = (Date.now() - sessionStartTime.getTime()) / (1000 * 60 * 60); // hours
                addXP(sessionTime * XP_CONFIG.XP_SOURCES.HOUR_DRIVEN, 'hour_driven');
            }
            
            // Update final stats display
            const duration = sessionStartTime ? Math.round((Date.now() - sessionStartTime.getTime()) / 60000) : 0;
            document.getElementById('trackingStats').innerHTML = `
                <div>Distance: ${totalDistance.toFixed(2)} miles</div>
                <div>Points: ${currentRoute.length}</div>
                <div>Duration: ${duration} minutes</div>
            `;
            
            console.log('üìç Route tracking stopped');
            console.log(`üìä Session: ${totalDistance.toFixed(2)} miles, ${speedData.length} data points`);
            
            // Show save modal if there's route data
            if (currentRoute.length > 0) {
                showRouteSaveModal();
            }
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 3959; // Earth's radius in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function updateTrackingStats() {
            if (speedData.length > 0) {
                const avgSpeed = speedData.reduce((a, b) => a + b, 0) / speedData.length;
                const maxSpeed = Math.max(...speedData);
                
                document.getElementById('avgSpeed').textContent = avgSpeed.toFixed(1);
                document.getElementById('maxSpeed').textContent = maxSpeed.toFixed(1);
                document.getElementById('totalDistance').textContent = totalDistance.toFixed(1);
                
                // Update user stats
                if (currentUser) {
                    if (!currentUser.stats) currentUser.stats = {};
                    currentUser.stats.totalDistance = (currentUser.stats.totalDistance || 0) + totalDistance;
                    currentUser.stats.avgSpeed = Math.max(currentUser.stats.avgSpeed || 0, avgSpeed);
                    currentUser.stats.maxSpeed = Math.max(currentUser.stats.maxSpeed || 0, maxSpeed);
                }
            }
        }


        function initializeGForceMonitoring() {
            // Check if device supports motion sensors
            if (window.DeviceMotionEvent) {
                document.getElementById('gForceMonitor').style.display = 'block';
                
                let lastAcceleration = { x: 0, y: 0, z: 0 };
                let lastTime = Date.now();
                
                window.addEventListener('devicemotion', (event) => {
                    if (event.acceleration) {
                        const acc = event.acceleration;
                        const currentTime = Date.now();
                        const deltaTime = (currentTime - lastTime) / 1000;
                        
                        if (deltaTime > 0.1) { // Update every 100ms
                            // Calculate G-force magnitude
                            const gForce = Math.sqrt(
                                Math.pow(acc.x || 0, 2) + 
                                Math.pow(acc.y || 0, 2) + 
                                Math.pow(acc.z || 0, 2)
                            ) / 9.81; // Convert to G units
                            
                            // Update display
                            document.getElementById('gForceValue').textContent = gForce.toFixed(1) + ' G';
                            
                            // Store G-force data
                            gForceData.push(gForce);
                            
                            // Check for G-force achievements
                            checkAchievements('g_force');
                            
                            lastTime = currentTime;
                        }
                    }
                });
            } else {
                console.log('Device motion not supported');
            }
        }

        function showPage(pageId) {
            if (!pageId) {
                console.error('‚ùå No page ID provided to showPage');
                return;
            }
            
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            const targetPage = document.getElementById(pageId);
            if (!targetPage) {
                console.error('‚ùå Page not found:', pageId);
                return;
            }
            targetPage.classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-links li').forEach(li => {
                li.classList.remove('active');
            });
            
            // Special handling for different pages
            if (pageId === 'admin') {
                if (currentUser && currentUser.isAdmin) {
                    loadAdminStats();
                } else {
                    alert('Admin access required');
                    showPage('dashboard');
                    return;
                }
            } else if (pageId === 'routes') {
                // Initialize map if not already done
                if (!map) {
                    setTimeout(() => {
                        initializeMap();
                    }, 100);
                }
                loadRouteHistory();
                loadSharedRoutes();
            }
        }

        // Route Tab Functions
        function showRouteTab(tabId) {
            // Hide all route content
            document.querySelectorAll('.route-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.route-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected content and activate tab
            document.getElementById(tabId + 'Content').style.display = 'block';
            document.getElementById(tabId + 'Tab').classList.add('active');
            
            // Refresh map if switching to tracking tab
            if (tabId === 'tracking') {
                setTimeout(() => {
                    refreshMap();
                }, 100);
            }
            
            // Load data for specific tabs
            if (tabId === 'history') {
                loadRouteHistory();
            } else if (tabId === 'shared') {
                loadSharedRoutes();
            }
        }

        function loadRouteHistory() {
            const routes = JSON.parse(localStorage.getItem('routes') || '[]');
            const userRoutes = routes.filter(r => r.userId === currentUser.id).reverse();
            const historyDiv = document.getElementById('routeHistory');
            
            if (userRoutes.length === 0) {
                historyDiv.innerHTML = '<p style="opacity: 0.7;">No routes tracked yet. Start your first journey!</p>';
                return;
            }
            
            let historyHTML = '';
            userRoutes.forEach(route => {
                const duration = Math.round(route.duration / 60); // Convert to minutes
                const date = new Date(route.timestamp).toLocaleString();
                
                historyHTML += `
                    <div class="route-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <h4 style="margin: 0; color: #00ffff;">${route.name || `Route ${route.id.slice(-6)}`}</h4>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn secondary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" onclick="viewRouteOnMap('${route.id}')">üìç View</button>
                                <button class="btn admin" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" onclick="shareRoute('${route.id}')">üåê Share</button>
                            </div>
                        </div>
                        <div class="route-stats">
                            <div class="route-stat">
                                <div class="route-stat-value">${route.distance.toFixed(1)}</div>
                                <div class="route-stat-label">Miles</div>
                            </div>
                            <div class="route-stat">
                                <div class="route-stat-value">${duration}</div>
                                <div class="route-stat-label">Minutes</div>
                            </div>
                            <div class="route-stat">
                                <div class="route-stat-value">${route.avgSpeed.toFixed(1)}</div>
                                <div class="route-stat-label">Avg MPH</div>
                            </div>
                            <div class="route-stat">
                                <div class="route-stat-value">${route.maxSpeed.toFixed(1)}</div>
                                <div class="route-stat-label">Max MPH</div>
                            </div>
                        </div>
                        <small style="opacity: 0.7;">${date}</small>
                    </div>
                `;
            });
            
            historyDiv.innerHTML = historyHTML;
        }

        function loadSharedRoutes() {
            const routes = JSON.parse(localStorage.getItem('routes') || '[]');
            const sharedRoutes = routes.filter(r => r.shared === true);
            const sharedDiv = document.getElementById('sharedRoutes');
            
            if (sharedRoutes.length === 0) {
                sharedDiv.innerHTML = '<p style="opacity: 0.7;">No shared routes available. Share your first route!</p>';
                return;
            }
            
            let sharedHTML = '';
            sharedRoutes.forEach(route => {
                const duration = Math.round(route.duration / 60);
                const date = new Date(route.timestamp).toLocaleString();
                
                sharedHTML += `
                    <div class="route-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <h4 style="margin: 0; color: #00ffff;">@${route.username}'s ${route.name || 'Route'}</h4>
                            <button class="btn secondary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" onclick="viewRouteOnMap('${route.id}')">üìç View</button>
                        </div>
                        <div class="route-stats">
                            <div class="route-stat">
                                <div class="route-stat-value">${route.distance.toFixed(1)}</div>
                                <div class="route-stat-label">Miles</div>
                            </div>
                            <div class="route-stat">
                                <div class="route-stat-value">${duration}</div>
                                <div class="route-stat-label">Minutes</div>
                            </div>
                            <div class="route-stat">
                                <div class="route-stat-value">${route.avgSpeed.toFixed(1)}</div>
                                <div class="route-stat-label">Avg MPH</div>
                            </div>
                        </div>
                        <small style="opacity: 0.7;">${date}</small>
                    </div>
                `;
            });
            
            sharedDiv.innerHTML = sharedHTML;
        }

        function viewRouteOnMap(routeId) {
            const routes = JSON.parse(localStorage.getItem('routes') || '[]');
            const route = routes.find(r => r.id === routeId);
            
            if (!route) return;
            
            // Switch to tracking tab and show route on map
            showRouteTab('tracking');
            
            if (map && route.coordinates && route.coordinates.length > 0) {
                // Clear existing layers
                map.eachLayer(layer => {
                    if (layer instanceof L.Marker || layer instanceof L.Polyline) {
                        map.removeLayer(layer);
                    }
                });
                
                // Fit map to route bounds
                const bounds = L.latLngBounds(route.coordinates);
                map.fitBounds(bounds);
                
                // Draw route
                L.polyline(route.coordinates, {
                    color: '#00ffff',
                    weight: 4,
                    opacity: 0.8
                }).addTo(map);
                
                // Add start and end markers
                L.marker(route.coordinates[0], {
                    icon: L.divIcon({
                        className: 'start-marker',
                        html: 'üöÄ',
                        iconSize: [30, 30]
                    })
                }).addTo(map);
                
                L.marker(route.coordinates[route.coordinates.length - 1], {
                    icon: L.divIcon({
                        className: 'end-marker',
                        html: 'üèÅ',
                        iconSize: [30, 30]
                    })
                }).addTo(map);
            }
        }

        function shareRoute(routeId) {
            const routes = JSON.parse(localStorage.getItem('routes') || '[]');
            const routeIndex = routes.findIndex(r => r.id === routeId);
            
            if (routeIndex === -1) return;
            
            routes[routeIndex].shared = true;
            localStorage.setItem('routes', JSON.stringify(routes));
            
            alert('Route shared successfully! Others can now see it in the Shared Routes tab.');
            loadRouteHistory();
            loadSharedRoutes();
        }

        function showRouteSaveModal() {
            const duration = sessionStartTime ? Math.round((Date.now() - sessionStartTime.getTime()) / 60000) : 0;
            const avgSpeed = speedData.length > 0 ? speedData.reduce((a, b) => a + b, 0) / speedData.length : 0;
            
            // Update modal with route stats
            document.getElementById('modalDistance').textContent = `${totalDistance.toFixed(2)} miles`;
            document.getElementById('modalDuration').textContent = `${duration} minutes`;
            document.getElementById('modalPoints').textContent = currentRoute.length;
            document.getElementById('modalAvgSpeed').textContent = `${avgSpeed.toFixed(1)} mph`;
            
            // Set default route name
            document.getElementById('routeName').value = `Route ${new Date().toLocaleDateString()}`;
            
            // Show modal
            document.getElementById('routeSaveModal').style.display = 'flex';
        }

        function closeRouteSaveModal() {
            document.getElementById('routeSaveModal').style.display = 'none';
        }

        function saveRouteFromModal() {
            const routeName = document.getElementById('routeName').value.trim();
            const privacy = document.querySelector('input[name="routePrivacy"]:checked').value;
            
            if (routeName === '') {
                alert('Please enter a route name.');
                return;
            }
            
            saveRoute(routeName, privacy);
            closeRouteSaveModal();
        }

        function saveRoute(routeName, privacy = 'private') {
            if (currentRoute.length === 0) {
                alert('No route to save. Start tracking first!');
                return;
            }
            
            const route = {
                id: Date.now().toString(),
                name: routeName,
                userId: currentUser.id,
                username: currentUser.username,
                coordinates: currentRoute,
                distance: totalDistance,
                duration: sessionStartTime ? (Date.now() - sessionStartTime.getTime()) / 1000 : 0,
                avgSpeed: speedData.length > 0 ? speedData.reduce((a, b) => a + b, 0) / speedData.length : 0,
                maxSpeed: speedData.length > 0 ? Math.max(...speedData) : 0,
                timestamp: new Date().toISOString(),
                shared: privacy === 'public',
                privacy: privacy
            };
            
            const routes = JSON.parse(localStorage.getItem('routes') || '[]');
            routes.push(route);
            localStorage.setItem('routes', JSON.stringify(routes));
            
            // Add XP for route tracking
            addXP(XP_CONFIG.XP_SOURCES.ROUTE_TRACKED, 'route_tracked');
            
            alert(`‚úÖ Route "${routeName}" saved as ${privacy}!`);
            loadRouteHistory();
            
            console.log('üíæ Route saved:', routeName, 'Privacy:', privacy);
        }

        function loadAdminStats() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const routes = JSON.parse(localStorage.getItem('routes') || '[]');
            
            // Calculate storage usage
            const storageUsed = JSON.stringify(localStorage).length;
            const storageUsedKB = Math.round(storageUsed / 1024);
            
            document.getElementById('adminUserCount').textContent = users.length;
            document.getElementById('adminPostCount').textContent = posts.length;
            document.getElementById('adminRouteCount').textContent = routes.length;
            document.getElementById('adminStorageUsed').textContent = storageUsedKB + ' KB';
            
            // Load recent activity
            loadRecentActivity();
        }

        // Admin Tab Functions
        function showAdminTab(tabId) {
            // Hide all admin content
            document.querySelectorAll('.admin-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected content and activate tab
            document.getElementById(tabId + 'Content').style.display = 'block';
            document.getElementById(tabId + 'Tab').classList.add('active');
            
            // Load data for specific tabs
            if (tabId === 'users') {
                loadUsersList();
            } else if (tabId === 'posts') {
                loadPostsList();
            } else if (tabId === 'routes') {
                loadRoutesList();
            } else if (tabId === 'system') {
                loadSystemInfo();
            }
        }

        function loadRecentActivity() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const routes = JSON.parse(localStorage.getItem('routes') || '[]');
            
            // Get recent posts and routes
            const recentPosts = posts.slice(-5).reverse();
            const recentRoutes = routes.slice(-5).reverse();
            
            let activityHTML = '<h4>Recent Posts:</h4>';
            recentPosts.forEach(post => {
                activityHTML += `
                    <div class="admin-item">
                        <strong>@${post.username}</strong>: ${post.content.substring(0, 50)}${post.content.length > 50 ? '...' : ''}
                        <br><small>${new Date(post.timestamp).toLocaleString()}</small>
                    </div>
                `;
            });
            
            activityHTML += '<h4>Recent Routes:</h4>';
            recentRoutes.forEach(route => {
                activityHTML += `
                    <div class="admin-item">
                        <strong>@${route.username}</strong>: ${route.name || 'Unnamed Route'} (${route.distance.toFixed(1)} miles)
                        <br><small>${new Date(route.timestamp).toLocaleString()}</small>
                    </div>
                `;
            });
            
            document.getElementById('recentActivity').innerHTML = activityHTML;
        }

        function loadUsersList() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            let usersHTML = '';
            
            users.forEach(user => {
                const userPosts = JSON.parse(localStorage.getItem('posts') || '[]').filter(p => p.userId === user.id);
                const userRoutes = JSON.parse(localStorage.getItem('routes') || '[]').filter(r => r.userId === user.id);
                
                usersHTML += `
                    <div class="admin-item">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin: 0; color: #00ffff;">${user.name} (@${user.username})</h4>
                                <p style="margin: 0.25rem 0; opacity: 0.8;">${user.email}</p>
                                <small style="opacity: 0.7;">
                                    Joined: ${new Date(user.createdAt).toLocaleDateString()} | 
                                    Posts: ${userPosts.length} | 
                                    Routes: ${userRoutes.length} | 
                                    Level: ${user.level || 1}
                                </small>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn secondary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" onclick="viewUserDetails('${user.id}')">üëÅÔ∏è View</button>
                                <button class="btn admin" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; background: #dc3545; border-color: #dc3545;" onclick="deleteUser('${user.id}')">üóëÔ∏è Delete</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('usersList').innerHTML = usersHTML || '<p>No users found.</p>';
        }

        function loadPostsList() {
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            let postsHTML = '';
            
            posts.reverse().forEach(post => {
                postsHTML += `
                    <div class="admin-item">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin: 0; color: #00ffff;">@${post.username}</h4>
                                <p style="margin: 0.5rem 0;">${post.content}</p>
                                ${post.photo ? '<p style="opacity: 0.7;">üì∑ Contains photo</p>' : ''}
                                <small style="opacity: 0.7;">${new Date(post.timestamp).toLocaleString()}</small>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn admin" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; background: #dc3545; border-color: #dc3545;" onclick="deletePost('${post.id}')">üóëÔ∏è Delete</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('postsList').innerHTML = postsHTML || '<p>No posts found.</p>';
        }

        function loadRoutesList() {
            const routes = JSON.parse(localStorage.getItem('routes') || '[]');
            let routesHTML = '';
            
            routes.reverse().forEach(route => {
                const duration = Math.round(route.duration / 60);
                routesHTML += `
                    <div class="admin-item">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin: 0; color: #00ffff;">@${route.username}'s ${route.name || 'Route'}</h4>
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin: 0.5rem 0;">
                                    <div><strong>Distance:</strong> ${route.distance.toFixed(1)} miles</div>
                                    <div><strong>Duration:</strong> ${duration} min</div>
                                    <div><strong>Avg Speed:</strong> ${route.avgSpeed.toFixed(1)} mph</div>
                                    <div><strong>Points:</strong> ${route.coordinates.length}</div>
                                </div>
                                <small style="opacity: 0.7;">${new Date(route.timestamp).toLocaleString()}</small>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn secondary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" onclick="viewRouteOnMap('${route.id}')">üìç View</button>
                                <button class="btn admin" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; background: #dc3545; border-color: #dc3545;" onclick="deleteRoute('${route.id}')">üóëÔ∏è Delete</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('routesList').innerHTML = routesHTML || '<p>No routes found.</p>';
        }

        function loadSystemInfo() {
            const storageUsed = JSON.stringify(localStorage).length;
            const storageUsedKB = Math.round(storageUsed / 1024);
            const storageUsedMB = (storageUsedKB / 1024).toFixed(2);
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const routes = JSON.parse(localStorage.getItem('routes') || '[]');
            
            let storageHTML = `
                <div class="admin-item">
                    <h4>Storage Usage</h4>
                    <p><strong>Total Storage Used:</strong> ${storageUsedKB} KB (${storageUsedMB} MB)</p>
                    <p><strong>Users:</strong> ${users.length} entries</p>
                    <p><strong>Posts:</strong> ${posts.length} entries</p>
                    <p><strong>Routes:</strong> ${routes.length} entries</p>
                    <p><strong>Available Storage:</strong> ~${(5 - parseFloat(storageUsedMB)).toFixed(2)} MB remaining</p>
                </div>
                <div class="admin-item">
                    <h4>System Status</h4>
                    <p style="color: #51cf66;">‚úÖ System Online</p>
                    <p style="color: #51cf66;">‚úÖ Data Storage Active</p>
                    <p style="color: #51cf66;">‚úÖ GPS Tracking Available</p>
                    <p style="color: #51cf66;">‚úÖ Photo Upload Working</p>
                </div>
            `;
            
            document.getElementById('storageInfo').innerHTML = storageHTML;
        }

        // Admin Action Functions
        function refreshAdminStats() {
            loadAdminStats();
            alert('Admin stats refreshed!');
        }

        function refreshUsers() {
            loadUsersList();
        }

        function refreshPosts() {
            loadPostsList();
        }

        function refreshRoutes() {
            loadRoutesList();
        }

        function deleteAllPosts() {
            if (confirm('Are you sure you want to delete ALL posts? This cannot be undone!')) {
                localStorage.removeItem('posts');
                loadPostsList();
                loadAdminStats();
                alert('All posts deleted!');
            }
        }

        function deleteAllRoutes() {
            if (confirm('Are you sure you want to delete ALL routes? This cannot be undone!')) {
                localStorage.removeItem('routes');
                loadRoutesList();
                loadAdminStats();
                alert('All routes deleted!');
            }
        }

        function deleteRoute(routeId) {
            if (confirm('Are you sure you want to delete this route?')) {
                const routes = JSON.parse(localStorage.getItem('routes') || '[]');
                const updatedRoutes = routes.filter(r => r.id !== routeId);
                localStorage.setItem('routes', JSON.stringify(updatedRoutes));
                loadRoutesList();
                loadAdminStats();
                alert('Route deleted!');
            }
        }

        function exportAllData() {
            const data = {
                users: JSON.parse(localStorage.getItem('users') || '[]'),
                posts: JSON.parse(localStorage.getItem('posts') || '[]'),
                routes: JSON.parse(localStorage.getItem('routes') || '[]'),
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `drivesphere-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            alert('Data exported successfully!');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            if (data.users) localStorage.setItem('users', JSON.stringify(data.users));
                            if (data.posts) localStorage.setItem('posts', JSON.stringify(data.posts));
                            if (data.routes) localStorage.setItem('routes', JSON.stringify(data.routes));
                            
                            loadAdminStats();
                            alert('Data imported successfully!');
                        } catch (error) {
                            alert('Error importing data: Invalid file format');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function backupData() {
            exportAllData();
        }

        function restoreData() {
            importData();
        }

        function resetSystem() {
            if (confirm('Are you sure you want to reset the entire system? This will delete ALL data and cannot be undone!')) {
                localStorage.clear();
                alert('System reset complete! Please refresh the page.');
                location.reload();
            }
        }

        function generateReport() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            const routes = JSON.parse(localStorage.getItem('routes') || '[]');
            
            const report = `
DriveSphere System Report
Generated: ${new Date().toLocaleString()}

=== USER STATISTICS ===
Total Users: ${users.length}
Active Users: ${users.filter(u => u.lastLogin).length}
New Users (Last 7 days): ${users.filter(u => new Date(u.createdAt) > new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)).length}

=== CONTENT STATISTICS ===
Total Posts: ${posts.length}
Posts with Photos: ${posts.filter(p => p.photo).length}
Total Routes: ${routes.length}
Shared Routes: ${routes.filter(r => r.shared).length}

=== STORAGE STATISTICS ===
Storage Used: ${Math.round(JSON.stringify(localStorage).length / 1024)} KB
Average Posts per User: ${(posts.length / users.length).toFixed(1)}
Average Routes per User: ${(routes.length / users.length).toFixed(1)}

=== TOP USERS ===
${users.map(u => {
    const userPosts = posts.filter(p => p.userId === u.id).length;
    const userRoutes = routes.filter(r => r.userId === u.id).length;
    return `${u.username}: ${userPosts} posts, ${userRoutes} routes`;
}).join('\n')}
            `;
            
            const blob = new Blob([report], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `drivesphere-report-${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            URL.revokeObjectURL(url);
            
            alert('Report generated and downloaded!');
        }

        function viewAllUsers() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            let usersHTML = '<h4>All Users:</h4>';
            
            users.forEach(user => {
                usersHTML += `
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; margin: 0.5rem 0; border-radius: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${user.name}</strong> (@${user.username})<br>
                            <small>${user.email}</small><br>
                            <small>Joined: ${new Date(user.createdAt).toLocaleDateString()}</small>
                        </div>
                        <button class="btn" style="background: #dc3545; font-size: 0.8rem; padding: 0.5rem;" onclick="deleteUser('${user.id}')">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                `;
            });

            document.getElementById('adminContent').innerHTML = usersHTML;
        }

        function deleteUser(userId) {
            if (!confirm('Are you sure you want to delete this user?')) {
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const updatedUsers = users.filter(u => u.id !== userId);
            localStorage.setItem('users', JSON.stringify(updatedUsers));
            
            alert('User deleted successfully');
            viewAllUsers();
            loadAdminStats();
        }

        function viewAllPosts() {
            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            let postsHTML = '<h4>All Posts:</h4>';
            
            posts.reverse().forEach(post => {
                postsHTML += `
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; margin: 0.5rem 0; border-radius: 0.5rem;">
                        <strong>@${post.username}</strong><br>
                        <p>${post.content}</p>
                        <small>${new Date(post.timestamp).toLocaleString()}</small>
                    </div>
                `;
            });

            document.getElementById('adminContent').innerHTML = postsHTML;
        }

        function clearAllData() {
            if (!confirm('Are you sure you want to clear ALL data? This cannot be undone!')) {
                return;
            }

            localStorage.removeItem('users');
            localStorage.removeItem('posts');
            localStorage.removeItem('currentUser');
            localStorage.removeItem('rememberMe');
            
            alert('All data cleared');
            location.reload();
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                localStorage.removeItem('rememberMe');
                showAuthContainer();
                console.log('üëã User logged out');
            }
        }

        // Initialize demo data if none exists
        function initializeDemoData() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            if (users.length === 0) {
                const demoUsers = [
                    {
                        id: '1',
                        name: 'John Doe',
                        username: 'johndoe',
                        email: 'john@example.com',
                        password: 'password123',
                        createdAt: new Date().toISOString(),
                        stats: { totalDistance: 150, totalTime: 5, avgSpeed: 30, maxSpeed: 75 }
                    },
                    {
                        id: '2',
                        name: 'Jane Smith',
                        username: 'janesmith',
                        email: 'jane@example.com',
                        password: 'password123',
                        createdAt: new Date().toISOString(),
                        stats: { totalDistance: 200, totalTime: 8, avgSpeed: 25, maxSpeed: 60 }
                    }
                ];
                localStorage.setItem('users', JSON.stringify(demoUsers));
                console.log('üìä Demo users created');
            }

            const posts = JSON.parse(localStorage.getItem('posts') || '[]');
            if (posts.length === 0) {
                const demoPosts = [
                    {
                        id: '1',
                        userId: '1',
                        username: 'johndoe',
                        content: 'Just completed a great road trip! The scenery was amazing.',
                        timestamp: new Date(Date.now() - 3600000).toISOString()
                    },
                    {
                        id: '2',
                        userId: '2',
                        username: 'janesmith',
                        content: 'Found a new shortcut to work. Saving 10 minutes every day!',
                        timestamp: new Date(Date.now() - 7200000).toISOString()
                    }
                ];
                localStorage.setItem('posts', JSON.stringify(demoPosts));
                console.log('üìù Demo posts created');
            }
        }

        // Initialize demo data on first load
        initializeDemoData();
    </script>
</body>
</html>
