<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DriveSphere - Enhanced Version 🚗</title>
    
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: white;
            min-height: 100vh;
        }

        /* Authentication Styles */
        .auth-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 191, 255, 0.2);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .auth-title {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #00bfff, #0066cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .auth-subtitle {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 2rem;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            color: white;
            font-size: 1rem;
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-group input:focus {
            outline: none;
            border-color: #00bfff;
            box-shadow: 0 0 0 2px rgba(0, 191, 255, 0.2);
        }

        .auth-btn {
            background: linear-gradient(45deg, #00bfff, #0066cc);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 191, 255, 0.3);
        }

        .auth-btn-google {
            background: #db4437;
            margin-top: 0.5rem;
        }

        .auth-btn-google:hover {
            background: #c23321;
        }

        .auth-divider {
            margin: 1rem 0;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        .auth-switch {
            margin-top: 1rem;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .auth-switch a {
            color: #00bfff;
            text-decoration: none;
            cursor: pointer;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

        /* Main App Styles */
        .main-app {
            display: none;
        }

        .main-app.active {
            display: block;
        }

        .navbar {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0, 191, 255, 0.2);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00bfff;
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: color 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            color: #00bfff;
        }

        .user-menu {
            position: relative;
        }

        .user-info {
            color: #00bfff;
            font-weight: 600;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            background: rgba(0, 191, 255, 0.1);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 191, 255, 0.2);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .welcome-card h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #00bfff, #0066cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 191, 255, 0.2);
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #00bfff;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .feed-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 191, 255, 0.2);
            border-radius: 0.5rem;
            padding: 1.5rem;
        }

        .post {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #00bfff, #0066cc);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            font-weight: bold;
        }

        .post-username {
            color: #00bfff;
            font-weight: 600;
        }

        .post-time {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
            margin-left: auto;
        }

        .post-content {
            margin: 0.75rem 0;
            line-height: 1.6;
        }

        .post-actions {
            display: flex;
            gap: 1rem;
            margin-top: 0.75rem;
        }

        .btn {
            background: linear-gradient(45deg, #00bfff, #0066cc);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 191, 255, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
        }

        .create-post {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 191, 255, 0.2);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 2rem;
        }

        .create-post textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.25rem;
            padding: 0.75rem;
            color: white;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .create-post textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Map Styles */
        .map-container {
            height: 400px;
            border-radius: 0.5rem;
            overflow: hidden;
            border: 1px solid rgba(0, 191, 255, 0.2);
            margin-bottom: 1rem;
        }

        .speed-display {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 191, 255, 0.2);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .speed-value {
            font-size: 3rem;
            font-weight: bold;
            color: #00bfff;
        }

        .speed-unit {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .nav-links {
                gap: 1rem;
            }

            .container {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .auth-card {
                padding: 1.5rem;
            }
        }

        .hidden {
            display: none !important;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: #00bfff;
        }
    </style>
</head>
<body>
    <!-- Authentication Container -->
    <div id="authContainer" class="auth-container">
        <div class="auth-card">
            <!-- Login Form -->
            <div id="loginForm" class="auth-page">
                <h1 class="auth-title">🚗 DriveSphere</h1>
                <p class="auth-subtitle">Welcome back! Sign in to continue your driving journey.</p>
                
                <form class="auth-form" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required placeholder="Enter your password">
                    </div>
                    <div class="form-group" style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="rememberMe" style="margin: 0;">
                        <label for="rememberMe" style="margin: 0; cursor: pointer;">Remember me</label>
                    </div>
                    <button type="submit" class="auth-btn">Sign In</button>
                </form>
                
                <button onclick="signInWithGoogle()" class="auth-btn auth-btn-google">
                    📱 Sign in with Google
                </button>
                
                <div class="auth-divider">or</div>
                
                <button onclick="showAdminLogin()" class="auth-btn" style="background: #ff6b35; margin-top: 0.5rem;">
                    🔑 Admin Login
                </button>
                
                <div class="auth-switch">
                    Don't have an account? <a onclick="showRegister()">Sign up here</a>
                </div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="auth-page hidden">
                <h1 class="auth-title">🚗 Join DriveSphere</h1>
                <p class="auth-subtitle">Create your account and start your driving journey.</p>
                
                <form class="auth-form" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label for="registerName">Full Name</label>
                        <input type="text" id="registerName" required placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="registerUsername">Username</label>
                        <input type="text" id="registerUsername" required placeholder="Choose a username" oninput="checkUsernameAvailability()">
                        <div id="usernameStatus" style="font-size: 0.8rem; margin-top: 0.25rem;"></div>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" required placeholder="Create a password">
                    </div>
                    <button type="submit" class="auth-btn">Create Account</button>
                </form>
                
                <button onclick="signInWithGoogle()" class="auth-btn auth-btn-google">
                    📱 Sign up with Google
                </button>
                
                <div class="auth-divider">or</div>
                
                <div class="auth-switch">
                    Already have an account? <a onclick="showLogin()">Sign in here</a>
                </div>
            </div>

            <!-- Admin Login Form -->
            <div id="adminLoginForm" class="auth-page hidden">
                <h1 class="auth-title">🔑 Admin Access</h1>
                <p class="auth-subtitle">Enter admin key to access admin panel.</p>
                
                <form class="auth-form" onsubmit="handleAdminLogin(event)">
                    <div class="form-group">
                        <label for="adminKey">Admin Key</label>
                        <input type="password" id="adminKey" required placeholder="Enter admin key">
                    </div>
                    <button type="submit" class="auth-btn" style="background: #ff6b35;">Access Admin Panel</button>
                </form>
                
                <div class="auth-switch">
                    <a onclick="showLogin()">← Back to Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="logo" onclick="showPage('dashboard')">🚗 DriveSphere</div>
            <ul class="nav-links">
                <li><a class="nav-link active" onclick="showPage('dashboard')">Dashboard</a></li>
                <li><a class="nav-link" onclick="showPage('feed')">Feed</a></li>
                <li><a class="nav-link" onclick="showPage('routes')">Routes</a></li>
                <li><a class="nav-link" onclick="showPage('analytics')">Analytics</a></li>
                <li><a class="nav-link" onclick="showPage('profile')">Profile</a></li>
            </ul>
            <div class="user-menu">
                <div class="user-info" onclick="showPage('profile')">
                    <span id="userDisplayName">Driver</span> 👤
                </div>
            </div>
        </nav>

        <div class="container">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="welcome-card">
                    <h1>🚗 Welcome to DriveSphere</h1>
                    <p>Your social GPS tracking and route sharing platform</p>
                </div>

                <!-- Speed Display -->
                <div class="speed-display">
                    <div class="speed-value" id="currentSpeed">0</div>
                    <div class="speed-unit">mph</div>
                    <p style="margin-top: 0.5rem; color: rgba(255, 255, 255, 0.7);">Current Speed</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalMiles">0</div>
                        <div class="stat-label">Total Miles</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="routesShared">0</div>
                        <div class="stat-label">Routes Shared</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="xpPoints">0</div>
                        <div class="stat-label">XP Points</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="userLevel">1</div>
                        <div class="stat-label">Level</div>
                    </div>
                </div>

                <div class="feed-container">
                    <h2 style="margin-bottom: 1rem;">Recent Activity</h2>
                    <div id="recentActivity">
                        <div class="loading">Loading activity...</div>
                    </div>
                </div>
            </div>

            <!-- Feed Page -->
            <div id="feed" class="page">
                <div class="create-post">
                    <h3 style="margin-bottom: 1rem;">Share Your Drive</h3>
                    <textarea id="postContent" placeholder="What's on your mind? Share your latest driving experience..."></textarea>
                    <div style="margin-top: 1rem;">
                        <button class="btn" onclick="createPost()">📝 Post</button>
                        <button class="btn btn-secondary" onclick="addPhoto()">📷 Add Photo</button>
                    </div>
                </div>

                <div class="feed-container">
                    <h2 style="margin-bottom: 1rem;">Community Feed</h2>
                    <div id="feedPosts">
                        <div class="loading">Loading posts...</div>
                    </div>
                </div>
            </div>

            <!-- Routes Page -->
            <div id="routes" class="page">
                <h2 style="margin-bottom: 2rem;">GPS Routes & Tracking</h2>
                
                <!-- Map -->
                <div class="map-container">
                    <div id="map"></div>
                </div>

                <!-- Route Controls -->
                <div style="margin-bottom: 2rem; text-align: center;">
                    <button class="btn" onclick="startTracking()" id="trackBtn">🚀 Start Tracking</button>
                    <button class="btn btn-secondary" onclick="stopTracking()" id="stopBtn" disabled>⏹️ Stop</button>
                    <button class="btn btn-secondary" onclick="saveRoute()">💾 Save Route</button>
                </div>

                <div id="savedRoutes">
                    <div class="loading">Loading routes...</div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analytics" class="page">
                <h2 style="margin-bottom: 2rem;">Driving Analytics</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="monthlyMiles">0</div>
                        <div class="stat-label">Miles This Month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgSpeed">0</div>
                        <div class="stat-label">Average Speed (mph)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="driveTime">0h</div>
                        <div class="stat-label">Total Drive Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="achievements">0</div>
                        <div class="stat-label">Achievements</div>
                    </div>
                </div>

                <div class="feed-container">
                    <h3 style="margin-bottom: 1rem;">Weekly Summary</h3>
                    <div id="weeklySummary">
                        <div class="loading">Analyzing your driving data...</div>
                    </div>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile" class="page">
                <h2 style="margin-bottom: 2rem;">Your Profile</h2>
                
                <div class="feed-container">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(45deg, #00bfff, #0066cc); display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 2rem; font-weight: bold;" id="profileAvatar">
                            D
                        </div>
                        <h3 id="profileName">Driver</h3>
                        <p style="color: rgba(255, 255, 255, 0.7);" id="profileInfo">Level 1 • 0 XP</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="profileRoutes">0</div>
                            <div class="stat-label">Routes Completed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="profileMiles">0</div>
                            <div class="stat-label">Total Miles</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="profileFriends">0</div>
                            <div class="stat-label">Friends</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="profileAchievements">0</div>
                            <div class="stat-label">Achievements</div>
                        </div>
                    </div>

                    <div style="margin-top: 2rem;">
                        <h4 style="margin-bottom: 1rem;">Recent Achievements</h4>
                        <div id="recentAchievements">
                            <div class="loading">Loading achievements...</div>
                        </div>
                    </div>

                    <div style="margin-top: 2rem; text-align: center;">
                        <button class="btn" style="background: #dc3545;" onclick="logout()">🚪 Logout</button>
                    </div>
                </div>
            </div>

            <!-- Admin Page -->
            <div id="admin" class="page">
                <h2 style="margin-bottom: 2rem;">🔑 Admin Panel</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalPosts">0</div>
                        <div class="stat-label">Total Posts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalRoutes">0</div>
                        <div class="stat-label">Total Routes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeUsers">0</div>
                        <div class="stat-label">Active Users</div>
                    </div>
                </div>

                <div class="feed-container">
                    <h3 style="margin-bottom: 1rem;">System Management</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button class="btn" onclick="loadAdminStats()">📊 Refresh Stats</button>
                        <button class="btn" onclick="viewAllUsers()">👥 View Users</button>
                        <button class="btn" onclick="viewAllPosts()">📝 View Posts</button>
                        <button class="btn" onclick="exportData()">💾 Export Data</button>
                    </div>
                    
                    <div id="adminContent" style="margin-top: 2rem;">
                        <p>Welcome to the DriveSphere Admin Panel. Use the buttons above to manage the system.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, setPersistence, browserLocalPersistence, browserSessionPersistence } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, setDoc, updateDoc, deleteDoc, query, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAZzG0RyiPwkRWno9WItyXyQIlJi0BDJdk",
            authDomain: "drivesphere-51ba0.firebaseapp.com",
            databaseURL: "https://drivesphere-51ba0-default-rtdb.firebaseio.com",
            projectId: "drivesphere-51ba0",
            storageBucket: "drivesphere-51ba0.firebasestorage.app",
            messagingSenderId: "866927856372",
            appId: "1:866927856372:web:7a59d1c5cf1c1a65bf6ca1",
            measurementId: "G-8SBJ8JLSLW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // Set default persistence to local (stays logged in)
        setPersistence(auth, browserLocalPersistence).then(() => {
            console.log('🔐 Firebase persistence set to LOCAL - users will stay logged in');
        }).catch((error) => {
            console.error('❌ Error setting persistence:', error);
        });

        // Make Firebase services globally available
        window.auth = auth;
        window.db = db;
        window.firebase = {
            auth: auth,  // Add auth object to firebase
            db: db,      // Add db object to firebase
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            signInWithPopup,
            GoogleAuthProvider: googleProvider,
            signOut,
            onAuthStateChanged,
            setPersistence,
            browserLocalPersistence,
            browserSessionPersistence,
            collection,
            addDoc,
            getDocs,
            doc,
            setDoc,
            updateDoc,
            deleteDoc,
            query,
            orderBy,
            limit
        };

        console.log('🔥 Firebase initialized successfully!');
    </script>

    <!-- Leaflet JS for Maps -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Main Application JavaScript -->
    <script>
        // Global variables
        let currentUser = null;
        let map = null;
        let userMarker = null;
        let currentRoute = [];
        let isTracking = false;
        let watchId = null;
        let userStats = {
            totalMiles: 0,
            routesShared: 0,
            xpPoints: 0,
            level: 1
        };

        // Authentication Functions
        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('adminLoginForm').classList.add('hidden');
        }

        function showAdminLogin() {
            document.getElementById('adminLoginForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        async function handleAdminLogin(event) {
            event.preventDefault();
            const adminKey = document.getElementById('adminKey').value;
            
            if (adminKey === '5478') {
                // Create admin user
                const adminUser = {
                    uid: 'admin-5478',
                    email: 'admin@drivesphere.org',
                    displayName: 'Admin',
                    role: 'admin'
                };
                
                currentUser = adminUser;
                console.log('✅ Admin login successful');
                
                showMainApp();
                updateUserUI();
                initializeApp();
                
                // Show admin panel link
                addAdminPanelToNavbar();
                
            } else {
                alert('Invalid admin key');
            }
        }

        function addAdminPanelToNavbar() {
            const navLinks = document.querySelector('.nav-links');
            const adminLink = document.createElement('li');
            adminLink.innerHTML = '<a class="nav-link" onclick="showPage(\'admin\')" style="color: #ff6b35;">⚙️ Admin</a>';
            navLinks.appendChild(adminLink);
        }

        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;

            // Show loading state
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Signing in...';
            submitBtn.disabled = true;

            try {
                // Set persistence based on remember me
                if (rememberMe) {
                    // Keep user logged in across browser sessions
                    await window.firebase.setPersistence(auth, window.firebase.browserLocalPersistence);
                    localStorage.setItem('rememberMe', 'true');
                } else {
                    // Only keep logged in for current session
                    await window.firebase.setPersistence(auth, window.firebase.browserSessionPersistence);
                    localStorage.setItem('rememberMe', 'false');
                }

                const userCredential = await window.firebase.signInWithEmailAndPassword(auth, email, password);
                console.log('✅ Login successful:', userCredential.user);
                console.log('🔄 Switching to main app...');
                
                // Manual redirect as backup
                currentUser = userCredential.user;
                setTimeout(() => {
                    showMainApp();
                    updateUserUI();
                    initializeApp();
                    console.log('🚀 Manual redirect to main app');
                }, 1000);
                
            } catch (error) {
                console.error('❌ Login error:', error);
                alert('Login failed: ' + error.message);
                
                // Reset button
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // Username availability checking
        let usernameCheckTimeout;
        async function checkUsernameAvailability() {
            const username = document.getElementById('registerUsername').value.trim();
            const statusDiv = document.getElementById('usernameStatus');
            const registerBtn = document.getElementById('registerBtn');
            
            if (!username) {
                statusDiv.innerHTML = '';
                return;
            }
            
            if (username.length < 3) {
                statusDiv.innerHTML = '<span style="color: #ff6b6b;">Username must be at least 3 characters</span>';
                registerBtn.disabled = true;
                return;
            }
            
            clearTimeout(usernameCheckTimeout);
            statusDiv.innerHTML = '<span style="color: #ffd93d;">Checking availability...</span>';
            
            usernameCheckTimeout = setTimeout(async () => {
                try {
                    const usersSnapshot = await window.firebase.getDocs(window.firebase.collection(window.db, 'users'));
                    let usernameTaken = false;
                    
                    usersSnapshot.forEach((doc) => {
                        const userData = doc.data();
                        if (userData.username && userData.username.toLowerCase() === username.toLowerCase()) {
                            usernameTaken = true;
                        }
                    });
                    
                    if (usernameTaken) {
                        statusDiv.innerHTML = '<span style="color: #ff6b6b;">❌ Username taken</span>';
                        registerBtn.disabled = true;
                    } else {
                        statusDiv.innerHTML = '<span style="color: #51cf66;">✅ Username available</span>';
                        registerBtn.disabled = false;
                    }
                    
                } catch (error) {
                    console.error('Error checking username:', error);
                    statusDiv.innerHTML = '<span style="color: #ffd93d;">Unable to check availability</span>';
                    registerBtn.disabled = false;
                }
            }, 500);
        }

        async function handleRegister(event) {
            event.preventDefault();
            const name = document.getElementById('registerName').value;
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            // Show loading state
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Creating Account...';
            submitBtn.disabled = true;

            try {
                const userCredential = await window.firebase.createUserWithEmailAndPassword(auth, email, password);
                
                // Save user profile to Firestore
                await window.firebase.setDoc(window.firebase.doc(window.db, 'users', userCredential.user.uid), {
                    name: name,
                    username: username,
                    email: email,
                    createdAt: new Date(),
                    stats: userStats
                });

                console.log('✅ Registration successful:', userCredential.user);
                
            } catch (error) {
                console.error('❌ Registration error:', error);
                alert('Registration failed: ' + error.message);
                
                // Reset button
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        async function signInWithGoogle() {
            try {
                const result = await window.firebase.signInWithPopup(window.auth, window.firebase.GoogleAuthProvider);
                console.log('✅ Google sign-in successful:', result.user);
            } catch (error) {
                console.error('❌ Google sign-in error:', error);
                alert('Google sign-in failed: ' + error.message);
            }
        }

        async function logout() {
            try {
                await window.firebase.signOut(auth);
                console.log('✅ Logout successful');
            } catch (error) {
                console.error('❌ Logout error:', error);
            }
        }

        // Auth state observer - this handles persistence automatically
        window.firebase.onAuthStateChanged(auth, (user) => {
            console.log('🔄 Auth state changed:', user ? 'LOGGED IN' : 'LOGGED OUT');
            
            if (user) {
                console.log('✅ User is signed in:', user.email);
                currentUser = user;
                
                // Save login state
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('lastLogin', Date.now().toString());
                
                // Show main app immediately
                showMainApp();
                updateUserUI();
                initializeApp();
                console.log('🚀 Main app loaded');
                
            } else {
                console.log('❌ User is signed out');
                currentUser = null;
                
                // Clear login state
                localStorage.removeItem('userLoggedIn');
                localStorage.removeItem('lastLogin');
                
                showAuthContainer();
            }
        });

        function showMainApp() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('mainApp').classList.add('active');
        }

        function showAuthContainer() {
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('mainApp').classList.remove('active');
        }

        async function updateUserUI() {
            if (currentUser) {
                try {
                    // Try to get user data from Firestore
                    const userDoc = await window.firebase.getDocs(
                        window.firebase.query(
                            window.firebase.collection(window.db, 'users'),
                            window.firebase.limit(1)
                        )
                    );

                    let displayName = currentUser.displayName || currentUser.email.split('@')[0];
                    let username = displayName;

                    // If user data exists in Firestore, use it
                    if (!userDoc.empty) {
                        const userData = userDoc.docs[0].data();
                        if (userData.username) {
                            username = userData.username;
                            displayName = userData.name || displayName;
                        }
                    }

                    document.getElementById('userDisplayName').textContent = `@${username}`;
                    document.getElementById('profileName').textContent = displayName;
                    document.getElementById('profileAvatar').textContent = username.charAt(0).toUpperCase();
                    
                } catch (error) {
                    console.error('Error loading user data:', error);
                    const displayName = currentUser.displayName || currentUser.email.split('@')[0];
                    document.getElementById('userDisplayName').textContent = displayName;
                    document.getElementById('profileName').textContent = displayName;
                    document.getElementById('profileAvatar').textContent = displayName.charAt(0).toUpperCase();
                }
                
                loadUserStats();
            }
        }

        // Navigation
        function showPage(pageId) {
            console.log('Showing page:', pageId);
            
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // Show selected page
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // Update navigation
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active'));
            
            // Find and activate the correct nav link
            navLinks.forEach(link => {
                if (link.onclick && link.onclick.toString().includes(pageId)) {
                    link.classList.add('active');
                }
            });

            // Initialize page-specific content
            if (pageId === 'routes') {
                initializeMap();
            } else if (pageId === 'feed') {
                loadFeed();
            } else if (pageId === 'dashboard') {
                loadDashboard();
            } else if (pageId === 'analytics') {
                loadAnalytics();
            } else if (pageId === 'profile') {
                loadProfile();
            } else if (pageId === 'admin') {
                loadAdminStats();
            }
        }

        // App Initialization
        function initializeApp() {
            console.log('🚀 Initializing DriveSphere app...');
            
            // Initialize GPS tracking
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        console.log('📍 GPS available');
                        updateSpeedDisplay(0); // Start with 0 speed
                    },
                    (error) => {
                        console.log('❌ GPS not available:', error);
                    }
                );
            }

            // Load initial data
            loadUserStats();
            loadDashboard();
        }

        // Map Functions
        function initializeMap() {
            console.log('🗺️ Initializing map...');
            
            // Wait for DOM to be ready
            setTimeout(() => {
                const mapContainer = document.getElementById('map');
                if (!mapContainer) {
                    console.log('❌ Map container not found');
                    return;
                }

                if (map) {
                    map.remove(); // Remove existing map
                }
                
                try {
                    map = L.map('map').setView([37.7749, -122.4194], 13); // Default to San Francisco

                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors'
                    }).addTo(map);

                    console.log('✅ Map initialized successfully');

                    // Get user's current location
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition((position) => {
                            const lat = position.coords.latitude;
                            const lon = position.coords.longitude;
                            
                            map.setView([lat, lon], 15);
                            
                            if (userMarker) {
                                userMarker.remove();
                            }
                            
                            userMarker = L.marker([lat, lon])
                                .addTo(map)
                                .bindPopup('You are here!')
                                .openPopup();
                                
                            console.log('📍 User location added to map');
                        }, (error) => {
                            console.log('📍 Location access denied, using default location');
                        });
                    }
                } catch (error) {
                    console.error('❌ Map initialization error:', error);
                    document.getElementById('map').innerHTML = '<div style="padding: 2rem; text-align: center; color: #00bfff;">Map loading... Please refresh the page if this persists.</div>';
                }
            }, 100);
        }

        // GPS Tracking Functions
        function startTracking() {
            if (!navigator.geolocation) {
                alert('GPS not available on this device');
                return;
            }

            isTracking = true;
            currentRoute = [];
            document.getElementById('trackBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;

            watchId = navigator.geolocation.watchPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const speed = position.coords.speed || 0;

                    // Add to route
                    currentRoute.push({ lat, lon, timestamp: Date.now() });

                    // Update map
                    if (map && userMarker) {
                        userMarker.setLatLng([lat, lon]);
                        map.setView([lat, lon]);
                    }

                    // Update speed display
                    const speedMph = speed * 2.237; // Convert m/s to mph
                    updateSpeedDisplay(Math.round(speedMph));

                    console.log('📍 Location updated:', { lat, lon, speed: speedMph });
                },
                (error) => {
                    console.error('GPS error:', error);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                }
            );

            console.log('🚀 GPS tracking started');
        }

        function stopTracking() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }

            isTracking = false;
            document.getElementById('trackBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;

            console.log('⏹️ GPS tracking stopped');
            
            if (currentRoute.length > 0) {
                console.log('Route recorded:', currentRoute.length, 'points');
            }
        }

        function updateSpeedDisplay(speed) {
            document.getElementById('currentSpeed').textContent = speed;
        }

        async function saveRoute() {
            if (!currentUser || currentRoute.length === 0) {
                alert('No route to save or user not logged in');
                return;
            }

            try {
                const routeData = {
                    userId: currentUser.uid,
                    userName: currentUser.displayName || currentUser.email,
                    route: currentRoute,
                    createdAt: new Date(),
                    distance: calculateRouteDistance(currentRoute),
                    duration: currentRoute.length > 0 ? currentRoute[currentRoute.length - 1].timestamp - currentRoute[0].timestamp : 0
                };

                await window.firebase.addDoc(window.firebase.collection(window.db, 'routes'), routeData);
                
                console.log('✅ Route saved successfully');
                alert('Route saved successfully!');
                
                // Update stats
                userStats.routesShared++;
                updateUserStats();
                
            } catch (error) {
                console.error('❌ Error saving route:', error);
                alert('Failed to save route: ' + error.message);
            }
        }

        function calculateRouteDistance(route) {
            // Simple distance calculation (rough estimate)
            let distance = 0;
            for (let i = 1; i < route.length; i++) {
                const prev = route[i - 1];
                const curr = route[i];
                distance += getDistanceBetweenPoints(prev.lat, prev.lon, curr.lat, curr.lon);
            }
            return distance;
        }

        function getDistanceBetweenPoints(lat1, lon1, lat2, lon2) {
            const R = 3959; // Earth's radius in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Social Features
        async function createPost() {
            const content = document.getElementById('postContent').value.trim();
            if (!content || !currentUser) {
                alert('Please write something or log in first');
                return;
            }

            try {
                const postData = {
                    userId: currentUser.uid,
                    userName: currentUser.displayName || currentUser.email,
                    content: content,
                    createdAt: new Date(),
                    likes: 0
                };

                await window.firebase.addDoc(window.firebase.collection(window.db, 'posts'), postData);
                
                document.getElementById('postContent').value = '';
                console.log('✅ Post created successfully');
                
                // Reload feed
                loadFeed();
                
                // Update XP
                userStats.xpPoints += 10;
                updateUserStats();
                
            } catch (error) {
                console.error('❌ Error creating post:', error);
                alert('Failed to create post: ' + error.message);
            }
        }

        async function loadFeed() {
            try {
                const postsQuery = window.firebase.query(
                    window.firebase.collection(window.db, 'posts'),
                    window.firebase.orderBy('createdAt', 'desc'),
                    window.firebase.limit(20)
                );
                
                const querySnapshot = await window.firebase.getDocs(postsQuery);
                const posts = [];
                
                querySnapshot.forEach((doc) => {
                    posts.push({ id: doc.id, ...doc.data() });
                });

                displayFeedPosts(posts);
                
            } catch (error) {
                console.error('❌ Error loading feed:', error);
                document.getElementById('feedPosts').innerHTML = '<p>Error loading posts. Please try again.</p>';
            }
        }

        function displayFeedPosts(posts) {
            const container = document.getElementById('feedPosts');
            
            if (posts.length === 0) {
                container.innerHTML = '<p>No posts yet. Be the first to share your driving experience!</p>';
                return;
            }

            container.innerHTML = posts.map(post => `
                <div class="post">
                    <div class="post-header">
                        <div class="post-avatar">${post.userName ? post.userName.charAt(0).toUpperCase() : 'U'}</div>
                        <div class="post-username">${post.userName || 'Anonymous'}</div>
                        <div class="post-time">${formatTimeAgo(post.createdAt.toDate())}</div>
                    </div>
                    <div class="post-content">${post.content}</div>
                    <div class="post-actions">
                        <button class="btn btn-secondary">👍 ${post.likes} Likes</button>
                        <button class="btn btn-secondary">💬 Comment</button>
                        <button class="btn btn-secondary">📤 Share</button>
                    </div>
                </div>
            `).join('');
        }

        function formatTimeAgo(date) {
            const now = new Date();
            const diffInMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffInMinutes < 1) return 'Just now';
            if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) return `${diffInHours}h ago`;
            
            const diffInDays = Math.floor(diffInHours / 24);
            return `${diffInDays}d ago`;
        }

        // User Stats
        async function loadUserStats() {
            if (!currentUser) return;

            try {
                const userDoc = await window.firebase.getDocs(
                    window.firebase.query(
                        window.firebase.collection(window.db, 'users'),
                        window.firebase.limit(1)
                    )
                );

                if (!userDoc.empty) {
                    const userData = userDoc.docs[0].data();
                    if (userData.stats) {
                        userStats = { ...userStats, ...userData.stats };
                    }
                }

                updateStatsDisplay();
                
            } catch (error) {
                console.error('❌ Error loading user stats:', error);
            }
        }

        async function updateUserStats() {
            if (!currentUser) return;

            try {
                await window.firebase.setDoc(
                    window.firebase.doc(window.db, 'users', currentUser.uid),
                    { stats: userStats },
                    { merge: true }
                );

                updateStatsDisplay();
                
            } catch (error) {
                console.error('❌ Error updating user stats:', error);
            }
        }

        function updateStatsDisplay() {
            document.getElementById('totalMiles').textContent = Math.round(userStats.totalMiles);
            document.getElementById('routesShared').textContent = userStats.routesShared;
            document.getElementById('xpPoints').textContent = userStats.xpPoints;
            document.getElementById('userLevel').textContent = userStats.level;
            
            // Update profile page
            document.getElementById('profileRoutes').textContent = userStats.routesShared;
            document.getElementById('profileMiles').textContent = Math.round(userStats.totalMiles);
            document.getElementById('profileInfo').textContent = `Level ${userStats.level} • ${userStats.xpPoints} XP`;
        }

        // Page Loading Functions
        function loadDashboard() {
            updateStatsDisplay();
            
            // Load recent activity
            document.getElementById('recentActivity').innerHTML = `
                <div class="post">
                    <div class="post-content">Welcome to DriveSphere! Start by tracking your first route.</div>
                </div>
            `;
        }

        function loadAnalytics() {
            document.getElementById('monthlyMiles').textContent = Math.round(userStats.totalMiles * 0.7);
            document.getElementById('avgSpeed').textContent = '45';
            document.getElementById('driveTime').textContent = Math.round(userStats.totalMiles * 1.5) + 'h';
            document.getElementById('achievements').textContent = Math.floor(userStats.xpPoints / 100);
            
            document.getElementById('weeklySummary').innerHTML = `
                <p style="color: rgba(255, 255, 255, 0.8);">
                    Great week! You've been active with ${userStats.routesShared} routes shared and ${userStats.xpPoints} XP earned.
                    Keep up the excellent driving!
                </p>
            `;
        }

        function loadProfile() {
            updateStatsDisplay();
            
            document.getElementById('profileFriends').textContent = Math.floor(userStats.xpPoints / 50);
            document.getElementById('profileAchievements').textContent = Math.floor(userStats.xpPoints / 100);
            
            const achievementsList = [];
            if (userStats.xpPoints >= 100) achievementsList.push('🏆 Explorer - Earned 100+ XP');
            if (userStats.routesShared >= 5) achievementsList.push('🛣️ Route Master - Shared 5+ routes');
            if (userStats.totalMiles >= 100) achievementsList.push('📍 Distance Champion - Drove 100+ miles');
            
            if (achievementsList.length === 0) {
                achievementsList.push('🎯 Ready to start your journey!');
            }
            
            document.getElementById('recentAchievements').innerHTML = achievementsList.map(achievement => `
                <div style="background: rgba(0, 191, 255, 0.1); padding: 1rem; border-radius: 0.5rem; margin-bottom: 0.5rem;">
                    ${achievement}
                </div>
            `).join('');
        }

        function addPhoto() {
            alert('Photo upload feature coming soon!');
        }

        // Admin Functions
        async function loadAdminStats() {
            if (!currentUser || currentUser.role !== 'admin') {
                alert('Admin access required');
                return;
            }

            try {
                // Count users
                const usersSnapshot = await window.firebase.getDocs(window.firebase.collection(window.db, 'users'));
                document.getElementById('totalUsers').textContent = usersSnapshot.size;

                // Count posts
                const postsSnapshot = await window.firebase.getDocs(window.firebase.collection(window.db, 'posts'));
                document.getElementById('totalPosts').textContent = postsSnapshot.size;

                // Count routes
                const routesSnapshot = await window.firebase.getDocs(window.firebase.collection(window.db, 'routes'));
                document.getElementById('totalRoutes').textContent = routesSnapshot.size;

                // Active users (example)
                document.getElementById('activeUsers').textContent = Math.ceil(usersSnapshot.size * 0.7);

                console.log('✅ Admin stats loaded');

            } catch (error) {
                console.error('❌ Error loading admin stats:', error);
            }
        }

        async function viewAllUsers() {
            try {
                const usersSnapshot = await window.firebase.getDocs(window.firebase.collection(window.db, 'users'));
                let usersHTML = '<h4>All Users:</h4>';
                
                usersSnapshot.forEach((doc) => {
                    const user = doc.data();
                    const userId = doc.id;
                    usersHTML += `
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; margin: 0.5rem 0; border-radius: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${user.name || 'Unknown'}</strong> (@${user.username || 'no-username'})<br>
                                <small>${user.email}</small><br>
                                <small>Joined: ${user.createdAt?.toDate()?.toLocaleDateString() || 'Unknown'}</small>
                            </div>
                            <button class="btn" style="background: #dc3545; font-size: 0.8rem; padding: 0.5rem;" onclick="deleteUser('${userId}', '${user.email}')">
                                🗑️ Delete
                            </button>
                        </div>
                    `;
                });

                document.getElementById('adminContent').innerHTML = usersHTML;

            } catch (error) {
                console.error('❌ Error loading users:', error);
                document.getElementById('adminContent').innerHTML = '<p>Error loading users.</p>';
            }
        }

        async function deleteUser(userId, userEmail) {
            if (!confirm(`Are you sure you want to delete user: ${userEmail}?`)) {
                return;
            }

            try {
                // Delete user document from Firestore
                await window.firebase.deleteDoc(window.firebase.doc(window.db, 'users', userId));
                
                console.log('✅ User deleted from Firestore:', userEmail);
                alert('User deleted successfully from database');
                
                // Refresh user list
                viewAllUsers();
                loadAdminStats();
                
            } catch (error) {
                console.error('❌ Error deleting user:', error);
                alert('Failed to delete user: ' + error.message);
            }
        }

        async function viewAllPosts() {
            try {
                const postsSnapshot = await window.firebase.getDocs(
                    window.firebase.query(
                        window.firebase.collection(window.db, 'posts'),
                        window.firebase.orderBy('createdAt', 'desc')
                    )
                );
                
                let postsHTML = '<h4>All Posts:</h4>';
                
                postsSnapshot.forEach((doc) => {
                    const post = doc.data();
                    postsHTML += `
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; margin: 0.5rem 0; border-radius: 0.5rem;">
                            <strong>${post.userName}</strong><br>
                            <p>${post.content}</p>
                            <small>${post.createdAt?.toDate()?.toLocaleString() || 'Unknown time'}</small>
                        </div>
                    `;
                });

                document.getElementById('adminContent').innerHTML = postsHTML;

            } catch (error) {
                console.error('❌ Error loading posts:', error);
                document.getElementById('adminContent').innerHTML = '<p>Error loading posts.</p>';
            }
        }

        function exportData() {
            alert('Data export feature coming soon!');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚗 DriveSphere Enhanced Version Loading...');
            
            // Show auth by default
            showAuthContainer();
            
            console.log('✅ DriveSphere Enhanced Version Loaded Successfully!');
        });
    </script>
</body>
</html>
